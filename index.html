<!doctype html>
<html lang="cs">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fragmenty Budoucnosti 2125</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    html {
      height: 100%;
    }
    
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Courier New', monospace;
      overflow: hidden;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a0a15 0%, #1a1a2e 100%);
    }

    .game-wrapper {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
    }

    #gameCanvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .hud {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 20px;
      background: linear-gradient(180deg, rgba(0,0,0,0.85) 0%, transparent 100%);
      color: #00ff88;
      font-size: 16px;
      z-index: 10;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .hud-left {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .hud-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }

    .fragment-counter {
      background: rgba(0, 255, 136, 0.15);
      padding: 10px 18px;
      border-radius: 6px;
      border: 2px solid #00ff88;
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
    }

    .controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      padding: 15px 30px;
      border-radius: 8px;
      border: 2px solid #00ff88;
      color: #00ff88;
      font-size: 14px;
      z-index: 10;
      text-align: center;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
    }

    /* BOÄŒNÃ PANEL S MINIHRAMI */
    .side-panel {
      position: absolute;
      top: 50%;
      right: 20px;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 15;
    }

    .side-btn {
      background: rgba(0, 0, 0, 0.85);
      border: 2px solid #00ff88;
      color: #00ff88;
      padding: 10px 14px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      text-align: left;
      transition: all 0.3s ease;
      min-width: 180px;
    }

    .side-btn:hover {
      background: #00ff88;
      color: #0a0a15;
      box-shadow: 0 0 18px rgba(0, 255, 136, 0.7);
      transform: translateY(-1px);
    }

    @media (max-width: 768px) {
      .side-panel {
        top: auto;
        bottom: 95px;
        right: 10px;
        transform: none;
      }
    }

    .modal {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
      animation: fadeIn 0.3s ease;
      overflow-y: auto;
      padding: 20px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: linear-gradient(135deg, #0a0a15 0%, #1a1a2e 100%);
      padding: 40px;
      border-radius: 12px;
      border: 2px solid #00ff88;
      max-width: 1100px;
      max-height: 90%;
      overflow-y: auto;
      color: #00ff88;
      box-shadow: 0 0 40px rgba(0, 255, 136, 0.4);
      margin: auto;
    }

    .modal-content h2 {
      margin-top: 0;
      font-size: 28px;
      color: #00ff88;
      text-shadow: 0 0 15px #00ff88;
      margin-bottom: 10px;
    }

    .modal-content h3 {
      font-size: 20px;
      color: #00ff88;
      margin-top: 30px;
      margin-bottom: 15px;
    }

    .fragment-badge {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 5px;
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .badge-elite { background: #ffd700; color: #000; }
    .badge-denier { background: #ff4444; color: #fff; }
    .badge-scientist { background: #0088ff; color: #fff; }
    .badge-activist { background: #88ff00; color: #000; }

    .impact-box {
      background: rgba(255, 68, 68, 0.2);
      border: 2px solid #ff4444;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      font-size: 16px;
      line-height: 1.6;
    }

    .impact-box h3 {
      color: #ff4444;
      margin-top: 0;
    }

    .minigame-container {
      background: rgba(0, 255, 136, 0.1);
      border: 2px solid #00ff88;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }

    .system-dashboard {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    .system-card {
      background: rgba(0, 136, 255, 0.15);
      border: 2px solid #0088ff;
      border-radius: 8px;
      padding: 15px;
    }

    .system-card.critical {
      border-color: #ff4444;
      background: rgba(255, 68, 68, 0.2);
      animation: pulse-critical 1s infinite;
    }

    .system-card.excellent {
      border-color: #00ff88;
      background: rgba(0, 255, 136, 0.2);
    }

    .system-header {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .metric-row {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      font-size: 13px;
    }

    .metric-value {
      font-weight: bold;
    }

    .metric-value.good { color: #00ff88; }
    .metric-value.bad { color: #ff4444; }
    .metric-value.neutral { color: #ffa500; }

    .policies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 12px;
      margin: 20px 0;
      max-height: 500px;
      overflow-y: auto;
      padding: 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
    }

    .policy-card {
      background: rgba(0, 136, 255, 0.15);
      border: 2px solid #0088ff;
      padding: 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }

    .policy-card:hover:not(.disabled):not(.selected) {
      background: rgba(0, 136, 255, 0.3);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 136, 255, 0.4);
    }

    .policy-card.selected {
      background: rgba(0, 255, 136, 0.25);
      border-color: #00ff88;
    }

    .policy-card.disabled {
      opacity: 0.4;
      cursor: not-allowed;
      border-color: #666;
    }

    .policy-card.synergy-highlight {
      border-color: #00ff88;
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
    }

    .policy-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .policy-icon {
      font-size: 24px;
    }

    .policy-name {
      font-weight: bold;
      font-size: 14px;
      flex: 1;
    }

    .policy-desc {
      font-size: 12px;
      margin-bottom: 8px;
      opacity: 0.9;
      line-height: 1.4;
    }

    .policy-effects {
      display: flex;
      gap: 6px;
      font-size: 11px;
      flex-wrap: wrap;
    }

    .effect-badge {
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: bold;
    }

    .effect-badge.positive { background: rgba(0, 255, 136, 0.3); color: #00ff88; }
    .effect-badge.negative { background: rgba(255, 68, 68, 0.3); color: #ff4444; }

    .button {
      background: #00ff88;
      color: #0a0a15;
      border: none;
      padding: 14px 32px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
      margin-right: 10px;
      font-family: 'Courier New', monospace;
      transition: all 0.3s ease;
    }

    .button:hover {
      background: #00cc6a;
      transform: scale(1.05);
      box-shadow: 0 0 25px rgba(0, 255, 136, 0.6);
    }

    .button:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
    }

    .button-secondary {
      background: #0088ff;
      color: #0a0a15;
    }

    .button-secondary:hover {
      background: #0066cc;
    }

    .round-info {
      background: rgba(0, 136, 255, 0.2);
      border: 2px solid #0088ff;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
    }

    .crisis-modal {
      background: rgba(255, 165, 0, 0.2);
      border: 3px solid #ffa500;
      border-radius: 12px;
      padding: 25px;
      margin: 20px 0;
      animation: crisisAppear 0.5s ease;
    }

    @keyframes crisisAppear {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .game-over-box {
      background: linear-gradient(135deg, rgba(255, 68, 68, 0.3), rgba(255, 136, 68, 0.3));
      border: 3px solid #ff4444;
      border-radius: 12px;
      padding: 30px;
      margin: 20px 0;
      text-align: center;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 68, 68, 0.5); }
      50% { box-shadow: 0 0 40px rgba(255, 68, 68, 0.8); }
    }

    .victory-box {
      background: linear-gradient(135deg, rgba(0, 255, 136, 0.3), rgba(0, 255, 200, 0.3));
      border: 3px solid #00ff88;
      border-radius: 12px;
      padding: 30px;
      margin: 20px 0;
      text-align: center;
      animation: victory-pulse 2s infinite;
    }

    @keyframes victory-pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.5); }
      50% { box-shadow: 0 0 40px rgba(0, 255, 136, 0.8); }
    }

    @keyframes pulse-critical {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .category-filter {
      display: flex;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 8px 16px;
      background: rgba(0, 136, 255, 0.2);
      border: 2px solid #0088ff;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s;
    }

    .filter-btn:hover {
      background: rgba(0, 136, 255, 0.4);
    }

    .filter-btn.active {
      background: rgba(0, 255, 136, 0.3);
      border-color: #00ff88;
    }

    .sources {
      margin-top: 20px;
      padding: 15px;
      background: rgba(0, 136, 255, 0.1);
      border-left: 4px solid #0088ff;
      font-size: 14px;
    }

    /* Styl pro kalkulaÄku uhlÃ­kovÃ© stopy */
    .cf-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }

    .cf-question label {
      font-weight: bold;
      font-size: 14px;
      display: block;
      margin-bottom: 6px;
    }

    .cf-question select {
      width: 100%;
      padding: 8px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #0088ff;
      border-radius: 4px;
      color: #00ff88;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    .cf-note {
      font-size: 12px;
      opacity: 0.8;
      margin-top: 4px;
    }
    .mobile-controls {
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      padding: 0 20px;
      display: none; /* defaultnÄ› skrytÃ©, ukÃ¡Å¾eme jen na menÅ¡Ã­ch displejÃ­ch */
      justify-content: space-between;
      align-items: flex-end;
      z-index: 20;
      pointer-events: none; /* samotnÃ½ kontejner nebrÃ¡nÃ­ kliknutÃ­ na canvas */
    }

    .mobile-dpad,
    .mobile-action-wrapper {
      pointer-events: auto; /* ale vnitÅ™nÃ­ prvky jsou klikatelnÃ© */
    }

    .mobile-dpad {
      display: grid;
      grid-template-columns: 60px 60px 60px;
      grid-template-rows: 60px 60px 60px;
      gap: 8px;
    }

    .mobile-btn {
      background: rgba(0, 0, 0, 0.85);
      border: 2px solid #00ff88;
      border-radius: 999px;
      font-size: 20px;
      color: #00ff88;
      display: flex;
      justify-content: center;
      align-items: center;
      touch-action: none;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .mobile-btn:active {
      background: #00ff88;
      color: #0a0a15;
      box-shadow: 0 0 18px rgba(0, 255, 136, 0.7);
      transform: scale(0.96);
    }

    .mobile-action {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      font-size: 24px;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
    }

    @media (max-width: 768px) {
      /* Na mobilech posuneme textovÃ© ovlÃ¡dÃ¡nÃ­ vÃ½Å¡, aby nepÅ™ekÃ¡Å¾elo */
      .controls {
        bottom: 110px;
      }

      .mobile-controls {
        display: flex;
      }
    }

  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="game-wrapper">
   <canvas id="gameCanvas"></canvas>
   <div class="hud">
    <div class="hud-left">
     <div id="yearDisplay">
      ğŸŒ ROK: 2125
     </div>
     <div id="locationDisplay">
      ğŸ“ EVROPA - RozpadlÃ¡ civilizace
     </div>
    </div>
    <div class="hud-right">
     <div class="fragment-counter"><span id="fragmentCount">Fragmenty: 0/14</span>
     </div>
    </div>
   </div>
   <div class="controls">
    <div>
     ğŸ® WASD / Å ipky: Pohyb | E: Sebrat fragment (kdyÅ¾ jste blÃ­zko)
    </div>
   </div>
   <div class="mobile-controls">
     <div class="mobile-dpad">
       <div></div>
       <button class="mobile-btn" data-dir="up">â–²</button>
       <div></div>

       <button class="mobile-btn" data-dir="left">â—€</button>
       <div></div>
       <button class="mobile-btn" data-dir="right">â–¶</button>

       <div></div>
       <button class="mobile-btn" data-dir="down">â–¼</button>
       <div></div>
     </div>

     <div class="mobile-action-wrapper">
       <button class="mobile-btn mobile-action" id="mobileAction">E</button>
     </div>
   </div>

   <!-- BOÄŒNÃ PANEL S DODATEÄŒNÃMI MINIHRAMI -->
   <div class="side-panel">
    <button class="side-btn" onclick="openFactChecker()">
      ğŸ§  Fact-checker 2125
    </button>
    <button class="side-btn" onclick="openCarbonCalculator()">
      ğŸŒ¿ UhlÃ­kovÃ¡ stopa
    </button>
   </div>

   <div id="modalContainer"></div>
  </div>
  <script>
    const defaultConfig = {
      game_title: "Fragmenty Budoucnosti 2125",
      welcome_message: "Rok 2125. NoÄnÃ­ satelitnÃ­ snÃ­mky Evropy uÅ¾ neukazujÃ­ znÃ¡mÃ© tvary stÃ¡tÅ¯ â€“ jen ostrÃ© linie hrÃ¡zÃ­, tmavÃ© skvrny vysuÅ¡enÃ½ch oblastÃ­ a chaotickÃ© shluky svÄ›tel tam, kde se lidÃ© jeÅ¡tÄ› dokÃ¡zali udrÅ¾et.\n\nSever se stal ÃºtoÄiÅ¡tÄ›m: Norsko, Å vÃ©dsko, Skotsko. Jih â€“ Pyreneje, ItÃ¡lie, BalkÃ¡n â€“ je spÃ¡lenÃ½, vysuÅ¡enÃ½, ÄÃ¡steÄnÄ› opuÅ¡tÄ›nÃ½. MÄ›sta, o kterÃ½ch jste se uÄili v uÄebnicÃ­ch, uÅ¾ v podobnÃ© podobÄ› neexistujÃ­.\n\nTy jsi archivÃ¡Å™/ka z budoucnosti. PoslednÃ­ generace se snaÅ¾Ã­ pochopit, kde se stala chyba. V ruinÃ¡ch starÃ©ho kontinentu sbÃ­rÃ¡Å¡ fragmenty z roku 2025 â€“ ÄlÃ¡nky, projevy, osobnÃ­ denÃ­ky. Z kaÅ¾dÃ©ho mÃ­sta zÅ¯stala jen krÃ¡tkÃ¡ stopa. PosklÃ¡dej je dohromady a zjisti, proÄ jsme nevyuÅ¾ili poslednÃ­ Å¡anci.",
      final_message: "Fragmenty jsou kompletnÃ­. ZprÃ¡va je pÅ™ipravena k odeslÃ¡nÃ­ do roku 2025. MoÅ¾nÃ¡ ji nÄ›kdo vezme vÃ¡Å¾nÄ›.",
      background_color: "#0a0a15",
      surface_color: "#1a1a2e",
      text_color: "#00ff88",
      primary_action_color: "#00ff88",
      secondary_action_color: "#0088ff"
    };

    /* OtÃ¡zky pro Fact-checker 2125 */
    const FACT_CHECK_QUESTIONS = [
      {
        id: 1,
        statement: "â€KlimatickÃ¡ zmÄ›na je pÅ™irozenÃ½ cyklus, vÄ›dci se neshodujÃ­, zda za ni mÅ¯Å¾e ÄlovÄ›k.â€œ",
        correct: "misinfo",
        explanation: "VÃ­ce neÅ¾ 97 % publikujÃ­cÃ­ch klimatologÅ¯ se shoduje, Å¾e souÄasnÃ© oteplovÃ¡nÃ­ je zpÅ¯sobeno hlavnÄ› ÄlovÄ›kem. â€šVÄ›dci se neshodujÃ­â€˜ je typickÃ¡ dezinformaÄnÃ­ rÃ©torika."
      },
      {
        id: 2,
        statement: "â€SpalovÃ¡nÃ­ fosilnÃ­ch paliv zvyÅ¡uje koncentraci COâ‚‚ v atmosfÃ©Å™e a posiluje sklenÃ­kovÃ½ efekt.â€œ",
        correct: "truth",
        explanation: "Tohle je zÃ¡kladnÃ­ fyzika znÃ¡mÃ¡ vÃ­ce neÅ¾ 100 let (Fourier, Arrhenius, Tyndall). To je jÃ¡dro problÃ©mu klimatickÃ© zmÄ›ny."
      },
      {
        id: 3,
        statement: "â€PÃ¡r extrÃ©mnÄ› studenÃ½ch zim dokazuje, Å¾e se planeta neotepluje.â€œ",
        correct: "misinfo",
        explanation: "Klima je dlouhodobÃ½ trend, poÄasÃ­ je krÃ¡tkodobÃ©. GlobÃ¡lnÃ­ oteplovÃ¡nÃ­ nevyluÄuje lokÃ¡lnÄ› studenÃ© epizody â€“ prÃ¡vÄ› naopak, mÅ¯Å¾e mÄ›nit proudÄ›nÃ­ a extrÃ©my zesilovat."
      },
      {
        id: 4,
        statement: "â€VÄ›tÅ¡inu svÄ›tovÃ½ch emisÃ­ produkuje nÄ›kolik mÃ¡lo velkÃ½ch firem, ale vlÃ¡dy a jednotlivci majÃ­ poÅ™Ã¡d zÃ¡sadnÃ­ roli v regulaci a poptÃ¡vce.â€œ",
        correct: "truth",
        explanation: "VelkÃ© fosilnÃ­ firmy majÃ­ obrovskÃ½ podÃ­l, ale bez politickÃ½ch rozhodnutÃ­, regulacÃ­ a zmÄ›ny poptÃ¡vky se nic nezmÄ›nÃ­. â€šNemÃ¡ smysl dÄ›lat nic, protoÅ¾e za to mÅ¯Å¾ou jen korporaceâ€˜ je takÃ© forma rezignaÄnÃ­ dezinformace."
      }
    ];

    const FRAGMENTS = [
      { 
        id: "elite_1", 
        type: "elite", 
        title: "CEO Energy Corp - Greenwashing", 
        location: "LondÃ½n", 
        x: 360, 
        y: 220,
        historicalText: "LondÃ½nskÃ© finanÄnÃ­ centrum se leskne sklem a ocelÃ­, ale uvnitÅ™ zasedaÄky je vzduch tÄ›Å¾kÃ½ â€“ smÄ›s drahÃ½ch parfÃ©mÅ¯, kÃ¡vy a nervÃ³znÃ­ch ÃºsmÄ›vÅ¯. Kameramani mÃ­Å™Ã­ na pÃ³dium, PR tÃ½m pÅ™ipraven, grafy na LED obrazovce zÃ¡Å™Ã­ zelenÃ½mi barvami.\n\nğŸ“Š VÃROÄŒNÃ ZPRÃVA BP 2025 - PROJEV CEO\n\n\"Jsme hrdÃ­ na naÅ¡i prÅ¯kopnickou technologii 'Clean Coal Plus'. Investovali jsme 8 miliard dolarÅ¯ do snÃ­Å¾enÃ­ emisÃ­ o 15 % oproti standardnÃ­mu uhlÃ­. To je nÃ¡Å¡ zÃ¡vazek k udrÅ¾itelnÄ›jÅ¡Ã­ budoucnosti.\"\n\n\"NaÅ¡e kampaÅˆ Beyond Petroleum pokraÄuje. MÃ¡me nynÃ­ 2 % investic v obnovitelnÃ½ch zdrojÃ­ch. To je 400% nÃ¡rÅ¯st oproti roku 2020!\"\n\n\"ZÃ¡roveÅˆ jsme otevÅ™eli 47 novÃ½ch ropnÃ½ch vrtÅ¯ v SevernÃ­m moÅ™i. MusÃ­me bÃ½t realistÃ© â€“ svÄ›t potÅ™ebuje energii. NemÅ¯Å¾eme vypnout fosilnÃ­ paliva ze dne na den.\"\n\nAkcionÃ¡Å™i tleskajÃ­. Zisk: 28 miliard dolarÅ¯.\n\n--------------------------------\nğŸ” Greenwashing v praxi:\nâ€¢ PouÅ¾Ã­vÃ¡nÃ­ slov jako \"Clean\", \"Beyond\", \"Green\" u fosilnÃ­ch paliv\nâ€¢ ZdÅ¯razÅˆovÃ¡nÃ­ malÃ½ch â€zelenÃ½châ€œ investic (2 %) a zamlÄovÃ¡nÃ­ obÅ™Ã­ fosilnÃ­ ÄÃ¡sti\nâ€¢ PÅ™esouvÃ¡nÃ­ odpovÄ›dnosti na spotÅ™ebitele mÃ­sto na systÃ©m a vÃ½robu",
        impact2100: "ğŸ”¥ 'ÄŒistÅ¡Ã­ uhlÃ­' bylo jen marketing. Emise pokraÄovaly. BP zkrachovalo v roce 2067 po ztrÃ¡tÄ› 2.4 bilionu dolarÅ¯ na klimatickÃ½ch katastrofÃ¡ch a soudnÃ­ch Å¾alobÃ¡ch. CEO byl v roce 2055 souzen za klimatickÃ½ podvod â€“ zemÅ™el pÅ™ed verdiktem. LondÃ½n je pravidelnÄ› zaplavovÃ¡n. TemÅ¾e mÃ¡ nynÃ­ 8metrovÃ© protipovodÅˆovÃ© zdi. 2% investice do obnovitelnÃ½ch zdrojÅ¯ nestaÄily. 47 novÃ½ch ropnÃ½ch vrtÅ¯ pÅ™ililo benzÃ­n do poÅ¾Ã¡ru.\n\nğŸ§  Lekce: Greenwashing oddÃ¡lil skuteÄnou transformaci. LidÃ© mÄ›li pocit, Å¾e se 'nÄ›co dÄ›lÃ¡', zatÃ­mco se skoro nic nezmÄ›nilo.",
        minigame: { type: "greenwashing_quiz" },
        sources: ["IPCC AR6 Report (2021)", "The Guardian: Greenwashing investigation", "BP corporate reports"]
      },
      { 
        id: "elite_2", 
        type: "elite", 
        title: "Carbon Offsety - Net-Zero Sliby", 
        location: "VÃ­deÅˆ", 
        x: 630, 
        y: 360,
        historicalText: "V luxusnÃ­m konferenÄnÃ­m sÃ¡le ve VÃ­dni se za sklenÄ›nou stÄ›nou tÅ™pytÃ­ Å™eka. UvnitÅ™ znÃ­ klavÃ­rnÃ­ hudba a ÄÃ­Å¡nÃ­ci roznÃ¡Å¡ejÃ­ prosecco. Za Å™eÄnickÃ½m pultem visÃ­ velkÃ½ nÃ¡pis: \"NET-ZERO 2050 â€“ ODPOVÄšDNÃ BYZNYS\".\n\n\"NaÅ¡e spoleÄnost se zavazuje k net-zero do roku 2050. Budeme kompenzovat naÅ¡e emise prostÅ™ednictvÃ­m offsetovÃ½ch projektÅ¯ v rozvojovÃ½ch zemÃ­ch,\" Å™Ã­kÃ¡ CEO a na plÃ¡tnÄ› se objevujÃ­ fotky zelenÃ½ch lesÅ¯ a usmÄ›vavÃ½ch dÄ›tÃ­.\n\nğŸ§® Jak funguje carbon offset:\nâ€¢ Firma vypouÅ¡tÃ­ emise COâ‚‚ (napÅ™. leteckÃ¡ spoleÄnost).\nâ€¢ ZaplatÃ­ jinÃ©mu subjektu, kterÃ½ ÃºdajnÄ› emise snÃ­Å¾Ã­ (vÃ½sadba stromÅ¯, ochrana lesa, ÄistÃ© vaÅ™enÃ­ atd.).\nâ€¢ Na papÃ­Å™e je bilance \"0\" â€“ ale jen pokud jsou projekty skuteÄnÃ©, dodateÄnÃ©, trvalÃ© a mÄ›Å™itelnÃ©.\n\nProblÃ©m: Mnoho offsetÅ¯ nesplÅˆuje tyto podmÃ­nky. NÄ›kterÃ© â€chrÃ¡nÃ­ lesâ€œ, kterÃ½ nikdo nechtÄ›l kÃ¡cet. JinÃ© stromy uhynou za 10 let, zatÃ­mco COâ‚‚ zÅ¯stane v atmosfÃ©Å™e stovky let.",
        impact2100: "ğŸ’¸ Pouze malÃ¡ ÄÃ¡st offsetÅ¯ mÄ›la mÄ›Å™itelnÃ½ efekt. ÄŒÃ¡st projektÅ¯ byla podvod, ÄÃ¡st selhala po pÃ¡r letech. Emise pokraÄovaly bez podstatnÃ© zmÄ›ny.\n\nğŸš¨ DÅ¯sledek: Offsety se staly nÃ¡strojem odklÃ¡dÃ¡nÃ­ skuteÄnÃ© transformace. MÃ­sto sniÅ¾ovÃ¡nÃ­ emisÃ­ u zdroje se kupovaly levnÃ© papÃ­rovÃ© kredity.",
        sources: ["The Guardian (2023)", "Science journal offsety study"]
      },
      { 
        id: "denier_1", 
        type: "denier", 
        title: "VzdÄ›lÃ¡nÃ­ a odolnost vÅ¯Äi dezinformacÃ­m", 
        location: "Praha", 
        x: 620, 
        y: 320,
        historicalText: "TeleviznÃ­ studio v Praze. ModerÃ¡tor sedÃ­ za stolem, za nÃ­m velkÃ¡ obrazovka s nÃ¡pisem â€KlimatickÃ¡ PANIKA? Debata bez cenzuryâ€œ. Vedle sebe mÃ¡ klimatologa a samozvanÃ©ho â€klimatickÃ©ho skeptikaâ€œ, youtubera s milionem sledujÃ­cÃ­ch.\n\nSkeptik se usmÃ­vÃ¡ do kamery: \"KlimatickÃ¡ zmÄ›na je pÅ™irozenÃ½ cyklus. Planeta se vÅ¾dy oteplovala a ochlazovala. Neexistuje dÅ¯kaz, Å¾e souÄasnÃ© oteplovÃ¡nÃ­ je zpÅ¯sobeno ÄlovÄ›kem. VÄ›dci se jen honÃ­ za granty.\"\n\nV chatu pod vysÃ­lÃ¡nÃ­m se valÃ­ vlny komentÃ¡Å™Å¯, memÅ¯ a emoji. Algoritmus miluje konflikt.\n\n--------------------------------\nğŸ“ VzdÄ›lÃ¡nÃ­ a odolnost vÅ¯Äi dezinformacÃ­m:\nâ€¢ Dezinformace Äasto pouÅ¾Ã­vajÃ­ polopravdy â€“ napÅ™. \"klima se vÅ¾dy mÄ›nilo\", ale zamlÄÃ­, Å¾e tempo dneÅ¡nÃ­ho oteplovÃ¡nÃ­ je Å™Ã¡dovÄ› vyÅ¡Å¡Ã­.\nâ€¢ ÄŒasto zpochybÅˆujÃ­ vÄ›dce (\"majÃ­ granty\", \"jsou zkorumpovanÃ­\") mÃ­sto argumentÅ¯.\nâ€¢ CÃ­l nenÃ­ pÅ™esvÄ›dÄit o nÄ›jakÃ© alternativnÃ­ teorii, ale zasÃ­t pochybnost: \"Nikdo nic nevÃ­, tak proÄ nÄ›co dÄ›lat?\"\n\nğŸ›¡ï¸ Odolnost znamenÃ¡:\nâ€¢ ZnÃ¡t zÃ¡kladnÃ­ fakta (fyziku, vÄ›deckÃ½ konsenzus)\nâ€¢ UmÄ›t rozpoznat emoÄnÃ­ manipulaci a faleÅ¡nou rovnovÃ¡hu (\"vÄ›dec vs. youtuber\")\nâ€¢ VÄ›dÄ›t, jak fungujÃ­ algoritmy sociÃ¡lnÃ­ch sÃ­tÃ­ a echo-komory.",
        impact2100: "ğŸ”¥ Bylo to zpÅ¯sobeno ÄlovÄ›kem. OteplenÃ­ bylo 10x rychlejÅ¡Ã­ neÅ¾ jakÃ¡koli pÅ™irozenÃ¡ zmÄ›na v historii. PopÃ­rÃ¡nÃ­ zpomalilo akci o 15 kritickÃ½ch let. Miliony lidÃ­ uvÄ›Å™ily, Å¾e \"se stejnÄ› nedÃ¡ nic dÄ›lat\" â€“ a to se stalo sebenaplÅˆujÃ­cÃ­m se proroctvÃ­m.",
        sources: ["IPCC AR6 WG1", "NASA Climate Data"]
      },

      { 
        id: "scientist_1", 
        type: "scientist", 
        title: "DenÃ­k klimatoloÅ¾ky Dr. BergstrÃ¶m", 
        location: "Stockholm", 
        x: 800, 
        y: 180,
        historicalText: "Za oknem StockholmskÃ© univerzity padÃ¡ mokrÃ½ snÃ­h, ale v zasedaÄce je vedro. Notebooky, grafy, kÃ¡vovÃ© kelÃ­mky, podtrhanÃ© vÃ½tisky IPCC zprÃ¡vy.\n\n22. srpna 2025 - Stockholm\n\nPrÃ¡ce na IPCC zprÃ¡vÄ› je hotovÃ¡. 3 000 stran vÄ›deckÃ½ch dÅ¯kazÅ¯. 234 autorÅ¯ z 66 zemÃ­. 14 000 citovanÃ½ch studiÃ­. ZÃ¡vÄ›r je jasnÃ½: +2.7 Â°C do roku 2100 pÅ™i souÄasnÃ½ch politikÃ¡ch.\n\nPrezentovala jsem to dnes politikÅ¯m. UkÃ¡zala jsem jim grafy. TajÃ­cÃ­ ledovce. UmÃ­rajÃ­cÃ­ korÃ¡ly. Migrace. Hladomory. VÃ¡lky o vodu.\n\nJeden ministr se zeptal: \"Ale jste si jistÃ¡? Co kdyÅ¾ se modely mÃ½lÃ­?\"\n\nOdpovÄ›dÄ›la jsem: \"MÃ½lily se. Realita je HORÅ Ã, neÅ¾ pÅ™edpovÃ­daly modely pÅ™ed 20 lety. VÅ¾dy jsme byli pÅ™Ã­liÅ¡ konzervativnÃ­.\"\n\nDruhÃ½ ministr: \"To je pÅ™Ã­liÅ¡ alarmistickÃ©. MusÃ­me bÃ½t vyvÃ¡Å¾enÃ­.\"\n\nVyvÃ¡Å¾enÃ­? PLANETA JE V PLAMENECH. Co je vyvÃ¡Å¾enÃ© na tom Å™Ã­ct pravdu?\n\nOdeÅ¡la jsem z mÃ­stnosti. Plakala jsem v autÄ›. StrÃ¡vila jsem 30 let studiem klimatu. A oni se stÃ¡le ptajÃ­ \"Jste si jistÃ¡?\"",
        impact2100: "ğŸŒ¡ï¸ Dr. BergstrÃ¶m mÄ›la naprostou pravdu. Bylo to +2.8 Â°C, pÅ™esnÄ› jak varovala. JejÃ­ modely byly dokonce pÅ™Ã­liÅ¡ optimistickÃ© â€“ nÄ›kterÃ© tipping pointy pÅ™iÅ¡ly dÅ™Ã­ve. ZemÅ™ela v roce 2063 ve vÄ›ku 71 let, sledujÃ­c kolaps systÃ©mÅ¯, pÅ™ed kterÃ½mi varovala 38 let. PÅ™ed smrtÃ­ Å™ekla: \"VÄ›dÄ›li jsme. Å˜ekli jsme jim. A oni nÃ¡s ignorovali.\" JejÃ­ poslednÃ­ publikace: \"Nebylo to o vÄ›dÄ›. Bylo to o politickÃ© vÅ¯li, kterou nikdy nemÄ›li.\"",
        sources: ["IPCC AR6 (2021)", "Nature: Tipping points", "Climate scientist testimonies"]
      },
      { 
        id: "scientist_2", 
        type: "scientist", 
        title: "NorskÃ½ Model - PÅ™Ã­bÄ›h Transformace", 
        location: "Oslo", 
        x: 750, 
        y: 150,
        historicalText: "Na zasnÄ›Å¾enÃ©m parkoviÅ¡ti v Oslu stojÃ­ dlouhÃ¡ Å™ada tichÃ½ch aut. Å½Ã¡dnÃ½ zÃ¡pach benzÃ­nu, Å¾Ã¡dnÃ½ hluk motorÅ¯ â€“ jen pÃ­skÃ¡nÃ­ tramvajÃ­ a Å¡ustÄ›nÃ­ pneumatik na snÄ›hu. Pro nÃ¡vÅ¡tÄ›vnÃ­ky z roku 2025 to pÅ¯sobilo skoro jako sci-fi.\n\nNorsko v roce 2025: 90 % novÃ½ch aut jsou elektromobily. Jak jsme to dokÃ¡zali?\n\n1ï¸âƒ£ VyuÅ¾ili jsme naÅ¡e ropnÃ© bohatstvÃ­ CHYTÅ˜E â€“ investovali jsme do transformace, ne do luxusu.\n\n2ï¸âƒ£ MasivnÃ­ pobÃ­dky: Elektromobily bez DPH, bez silniÄnÃ­ danÄ›, zdarma parkovÃ¡nÃ­, jÃ­zda v busovÃ½ch pruzÃ­ch.\n\n3ï¸âƒ£ HustÃ¡ sÃ­Å¥ nabÃ­jeÄek â€“ kaÅ¾dÃ½ch 50 km.\n\n4ï¸âƒ£ VeÅ™ejnÃ½ konsensus â€“ vÅ¡echny strany podporovaly zmÄ›nu.\n\n5ï¸âƒ£ DlouhodobÃ¡ vize â€“ zaÄali jsme v roce 1990, vytrvali 35 let.\n\nMÅ¯Å¾e to fungovat vÅ¡ude? MÄ›li jsme vÃ½hodu ropnÃ©ho fondu 1.4 bilionu $. Ale princip je jasnÃ½: Investice + pobÃ­dky + infrastruktura + politickÃ¡ vÅ¯le = transformace je moÅ¾nÃ¡.",
        impact2100: "ğŸ‡³ğŸ‡´ Norsko bylo vzÃ¡cnÃ½m pÅ™Ã­bÄ›hem ÃºspÄ›chu. Ale i ono Äelilo problÃ©mÅ¯m: GlobÃ¡lnÃ­ oteplovÃ¡nÃ­ neÅ¡lo zastavit jednou zemÃ­. NorskÃ© lesy hoÅ™ely. Fjordy se oteplovaly. Rybolov kolaboval. Norsko bylo pÅ™ipravenÃ©, mÄ›lo zdroje na adaptaci. VÄ›tÅ¡ina svÄ›ta ne. UkÃ¡zali sprÃ¡vnou cestu, ale zbytek svÄ›ta je neÅ¡el. StÃ¡le prodÃ¡vali ropu a plyn jinÃ½m zemÃ­m â€“ lokÃ¡lnÃ­ Äistota, globÃ¡lnÃ­ emise pokraÄovaly.",
        minigame: {
          type: "norway_ev_transition",
          startYear: 2025,
          targetYear: 2035,
          targetEVPercentage: 100,
          budget: 50,
          policies: [
            { id: 1, name: "Å½Ã¡dnÃ© DPH na EV", cost: 5, effect: 15, desc: "Elektromobily bez 25% danÄ›" },
            { id: 2, name: "Zdarma parkovÃ¡nÃ­", cost: 3, effect: 8, desc: "EV parkujÃ­ zdarma ve mÄ›stech" },
            { id: 3, name: "BusovÃ© pruhy", cost: 2, effect: 10, desc: "EV mohou jet v busovÃ½ch pruzÃ­ch" },
            { id: 4, name: "NabÃ­jecÃ­ sÃ­Å¥", cost: 15, effect: 20, desc: "10 000 rychlonabÃ­jeÄek" },
            { id: 5, name: "Dotace na nÃ¡kup", cost: 10, effect: 18, desc: "5 000 â‚¬ na kaÅ¾dÃ© EV" },
            { id: 6, name: "DaÅˆ ze spalovÃ¡nÃ­", cost: -5, effect: 12, desc: "Extra daÅˆ na benzin/diesel auta" },
            { id: 7, name: "FiremnÃ­ flotily", cost: 8, effect: 14, desc: "Firmy musÃ­ mÃ­t 50 % EV" },
            { id: 8, name: "LevnÃ¡ elektÅ™ina", cost: 12, effect: 16, desc: "Dotace na elektÅ™inu pro dobÃ­jenÃ­" }
          ]
        },
        sources: ["Norwegian EV policy", "IEA Norway transport report", "Nature: Successful transition case study"]
      },
      { 
        id: "activist_1", 
        type: "activist", 
        title: "Dopis studentky - Budoucnost kterÃ¡ nÃ¡s ÄekÃ¡", 
        location: "Amsterdam", 
        x: 480, 
        y: 240,
        historicalText: "StarÃ© cihlovÃ© domy v Amsterdamu se zrcadlÃ­ v kanÃ¡le, ale hladina vody je vÃ½Å¡ neÅ¾ kdy dÅ™Ã­v. Na stole v malÃ©m podkrovnÃ­m pokoji leÅ¾Ã­ seÅ¡it s nÃ¡lepkou \"KLIMA\" a rozpitÃ½ Äaj.\n\n\"MilÃ¡ babiÄko,\n\nJe mi 19 let a mÃ¡m strach z budoucnosti. Studuji klimatologii na univerzitÄ› v Amsterdamu. KaÅ¾dÃ½ den se uÄÃ­me o katastrofÄ›, kterÃ¡ pÅ™ichÃ¡zÃ­ â€“ a nikdo nic nedÄ›lÃ¡.\n\nDnes jsme studovali zprÃ¡vu IPCC. +2.7 Â°C do roku 2100. VÃ­Å¡, co to znamenÃ¡? ZnamenÃ¡ to, Å¾e jÃ¡ a moje generace budeme Å¾Ã­t v pekle. ZnamenÃ¡ to sucho, povodnÄ›, migrace, vÃ¡lky.\n\nA vlÃ¡da? 'MÃ¡me plÃ¡n do roku 2050.' JÃ¡ mÃ¡m 19 let, babiÄko. V roce 2050 mi bude 44. CelÃ½ mÅ¯j Å¾ivot â€“ studium, kariÃ©ra, moÅ¾nÃ¡ dÄ›ti â€“ vÅ¡e ve svÄ›tÄ›, kterÃ½ se hroutÃ­.\n\nProchÃ¡zÃ­m po ulicÃ­ch, vidÃ­m lidi, kteÅ™Ã­ Å¾ijÃ­ normÃ¡lnÃ­ Å¾ivoty. Jako by nic. A jÃ¡ kÅ™iÄÃ­m uvnitÅ™: 'ProÄ to nikoho nezajÃ­mÃ¡?!'\n\nSlibujeÅ¡ mi, Å¾e budeÅ¡ bojovat za moji budoucnost?\n\nS lÃ¡skou,\nEmma\"",
        impact2100: "ğŸ’” Emma mÄ›la pravdu. Dostala pÅ™esnÄ› tu budoucnost, kterÃ© se bÃ¡la. V roce 2069 (ve 63 letech) emigrovala do SkandinÃ¡vie, kdyÅ¾ Amsterdam zaÄal stavÄ›t 15metrovÃ© protipovodÅˆovÃ© zdi. JejÃ­ dÄ›ti vyrÅ¯staly ve svÄ›tÄ› klimatickÃ©ho chaosu. JejÃ­ babiÄka zemÅ™ela v roce 2038, aniÅ¾ by vidÄ›la zÃ¡sadnÃ­ zmÄ›nu. Emminy dopisy z roku 2025 se staly symbolem ztracenÃ© generace â€“ generace, kterÃ¡ vidÄ›la katastrofu pÅ™ichÃ¡zet a nikdo je neposlouchal.",
        minigame: { type: "simple_quiz" },
        sources: ["IPCC AR6 Youth perspectives", "Climate anxiety research", "Intergenerational justice studies"]
      },
      { 
        id: "activist_2", 
        type: "activist", 
        title: "OpuÅ¡tÄ›nÃ© MÄ›sto - Granada", 
        location: "Granada", 
        x: 360, 
        y: 560,
        historicalText: "RÃ¡no v GranadÄ› bÃ½valo svÄ›Å¾Ã­. V roce 2025 se vÅ¡ak mÄ›sto probouzÃ­ do dalÅ¡Ã­ho dne s teplotami nad 40 Â°C jeÅ¡tÄ› pÅ™ed polednem. Ulice se lesknou horkem, klimatizace huÄÃ­ jako nekoneÄnÃ½ chorÃ¡l.\n\n\"Dnes jsem odeÅ¡el naposledy. Granada je prÃ¡zdnÃ¡. Teploty v lÃ©tÄ› pÅ™esahujÃ­ 48 Â°C. Voda je luxus. Stromy jsou mrtvÃ©. Ulice jsou opuÅ¡tÄ›nÃ©. Pamatuji si, jak tu bylo krÃ¡snÄ› â€“ Alhambra, zahrady, Å¾ivot. TeÄ je to peklo.\n\nVÅ¡ichni se stÄ›hujÃ­ na sever. NÄ›mci, PolÃ¡ci, Å vÃ©dovÃ© nÃ¡s nechtÄ›jÃ­. Jsme 'klimatiÄtÃ­ uprchlÃ­ci'. NaÅ¡e dÄ›ti se ptajÃ­, proÄ jsme nechali zniÄit nÃ¡Å¡ domov. NemÃ¡m odpovÄ›Ä.\"",
        impact2100: "ğŸ”¥ JiÅ¾nÃ­ Å panÄ›lsko je neobyvatelnÃ©. Granada byla opuÅ¡tÄ›na v roce 2068. 12 milionÅ¯ Å panÄ›lÅ¯ uprchlo na sever. Evropa se rozdÄ›lila â€“ bohatÃ½ chladnÃ½ sever vs. vylidnÄ›nÃ½ vypÃ¡lenÃ½ jih. MÄ›li jsme 50 let na prevenci. MÃ­sto toho jsme budovali zdi proti uprchlÃ­kÅ¯m.",
        minigame: { type: "simple_quiz" },
        sources: ["IPCC AR6 Regional Impacts", "Mediterranean climate projections", "Climate migration studies"]
      },
      { 
        id: "elite_3", 
        type: "elite", 
        title: "Energiewende Paradox - NÄ›meckÃ¡ Krize", 
        location: "BerlÃ­n", 
        x: 550, 
        y: 270,
        historicalText: "BerlÃ­n, tiskovÃ¡ konference po FukuÅ¡imÄ›. Transparenty â€Atomkraft? Nein danke!â€œ jeÅ¡tÄ› nestihly vyblednout. Politici stojÃ­ pÅ™ed kamerami a ohlaÅ¡ujÃ­ â€historickÃ© rozhodnutÃ­â€œ â€“ konec jadernÃ½ch elektrÃ¡ren v NÄ›mecku.\n\nğŸ“Š ANALÃZA NÄšMECKÃ‰ ENERGETICKÃ‰ POLITIKY 2011â€“2025\n\n**ROZHODNUTÃ (2011):** Po FukuÅ¡imÄ› NÄ›mecko zavÃ­rÃ¡ vÅ¡echny jadernÃ© elektrÃ¡rny do roku 2022. PlÃ¡n: nahradit je obnovitelnÃ½mi zdroji.\n\n**REALITA (2022):** JÃ¡dro zavÅ™enÃ©, ale obnovitelnÃ© nestihly nahradit kapacitu. Å˜eÅ¡enÃ­? Plyn z Ruska. Nord Stream 2.\n\n**KRIZE (2022â€“2023):** VÃ¡lka na UkrajinÄ›. RuskÃ½ plyn pÅ™estal tÃ©ct. NÄ›mecko v energetickÃ©m Å¡oku.\n\n**DÅ®SLEDKY:**\nâ€¢ Ceny elektÅ™iny: +340 % za 18 mÄ›sÃ­cÅ¯\nâ€¢ UhelnÃ© elektrÃ¡rny znovu spuÅ¡tÄ›ny (klimatickÃ© cÃ­le zniÄeny)\nâ€¢ PrÅ¯mysl migruje do USA a Asie\nâ€¢ Zima 2022/23: 12 000 ÃºmrtÃ­ na podchlazenÃ­ mezi chudÃ½mi\nâ€¢ Inflace: 11.6 % (nejvyÅ¡Å¡Ã­ od 1951)\n\n**POLITICKÃ EFEKT:**\nâ€¢ AfD (populistÃ©): 28 % v prÅ¯zkumech\nâ€¢ Protesty proti Green Deal: \"NejdÅ™Ã­ve topenÃ­, pak klima!\"\nâ€¢ BlokovÃ¡nÃ­ EU klimatickÃ½ch politik\nâ€¢ ParalÃ½za nÄ›meckÃ© vlÃ¡dy\n\n**CHYBA:** ZavÅ™eli jsme jÃ¡dro BEZ zÃ¡loÅ¾nÃ­ch zdrojÅ¯. SÃ¡zeli jsme vÅ¡e na plyn. Od diktÃ¡tora.",
        impact2100: "âš¡ NÄ›meckÃ¡ energetickÃ¡ krize se stala symbolem Å¡patnÄ› provedenÃ© transformace. IdeÃ¡l: 100% obnovitelnÃ©. Realita: ZÃ¡vislost na ruskÃ©m plynu, pak na uhlÃ­, pak kolaps prÅ¯myslu. DÅ¯sledky:\n\nğŸ”¥ **KLIMATICKÃ‰:** NÄ›meckÃ© emise vzrostly o 18 % v letech 2022â€“2027 kvÅ¯li nÃ¡vratu k uhlÃ­. CÃ­le Green Dealu zmaÅ™eny.\n\nğŸ’¸ **EKONOMICKÃ‰:** NÄ›meckÃ½ prÅ¯mysl (BASF, Siemens, BMW) pÅ™esunul vÃ½robu do USA. 2.4 milionu pracovnÃ­ch mÃ­st ztraceno do roku 2045.\n\nğŸ—³ï¸ **POLITICKÃ‰:** PopulistickÃ© strany vyuÅ¾ily krizi. AfD vlÃ¡dla v koalici 2029â€“2037. Blokovaly EU klimatickou legislativu po 15 let. Bez NÄ›mecka jako lÃ­dra EU Green Deal selhal.\n\nâ„ï¸ **SOCIÃLNÃ:** EnergetickÃ¡ chudoba postihla 18 milionÅ¯ NÄ›mcÅ¯. SpoleÄnost se rozÅ¡tÄ›pila: bohatÃ­ s tepelnÃ½mi Äerpadly vs. chudÃ­ mrznoucÃ­ v bytovkÃ¡ch.\n\nğŸ’€ **LEKCE:** Nebyla to jen nÄ›meckÃ¡ chyba. Byla to chyba celÃ© Evropy: ZavÃ­rÃ¡nÃ­ jÃ¡dra bez alternativy + zÃ¡vislost na autoritÃ¡Å™skÃ½ch reÅ¾imech + absence solidarity = katastrofa. Energiewende nebyl Å¡patnÃ½ nÃ¡pad. Byla to Å¡patnÃ¡ implementace v nejhorÅ¡Ã­m moÅ¾nÃ©m okamÅ¾iku.",
        sources: ["German Energy Transition reports", "Nord Stream 2 analysis", "AfD electoral data", "IPCC AR6"]
      },
      { 
        id: "elite_4", 
        type: "elite", 
        title: "Cap and Trade Policy", 
        location: "BudapeÅ¡Å¥", 
        x: 700, 
        y: 390,
        historicalText: "V zasedaÄce ministerstva v BudapeÅ¡ti se na stÅ¯l rozklÃ¡dÃ¡ barevnÃ¡ infografika EU ETS. Å ipky, ÄÃ­sla, grafy, kterÃ© majÃ­ veÅ™ejnosti vysvÄ›tlit, Å¾e vÅ¡e je pod kontrolou.\n\nEU Green Deal byl ambiciÃ³znÃ­ plÃ¡n. JednÃ­m z nÃ¡strojÅ¯ byla politika â€cap and tradeâ€œ â€“ stanovenÃ­ celkovÃ©ho limitu emisÃ­ (cap) a moÅ¾nost s povolenkami obchodovat (trade).\n\nğŸŒ Princip:\nâ€¢ Politika urÄÃ­ maximÃ¡lnÃ­ mnoÅ¾stvÃ­ emisÃ­ (cap).\nâ€¢ Firmy dostanou nebo koupÃ­ povolenky na urÄitÃ½ objem COâ‚‚.\nâ€¢ Kdo uÅ¡etÅ™Ã­, mÅ¯Å¾e povolenky prodat. Kdo zneÄiÅ¡Å¥uje vÃ­ce, musÃ­ dokoupit.\n\nV ideÃ¡lnÃ­m svÄ›tÄ› cap postupnÄ› klesÃ¡ a emise s nÃ­m. V reÃ¡lnÃ©m svÄ›tÄ› vÅ¡ak lobby tlaÄilo na pÅ™Ã­liÅ¡ Å¡tÄ›drÃ© pÅ™Ã­dÄ›ly, Ãºniky vÃ½jimek a volnÃ© povolenky pro â€strategickÃ© prÅ¯myslyâ€œ.",
        impact2100: "âš–ï¸ Cap and trade mohl bÃ½t velmi ÃºÄinnÃ½, pokud by byl cap opravdu nÃ­zkÃ½ a postupnÄ› klesajÃ­cÃ­. MÃ­sto toho byl Äasto pÅ™Ã­liÅ¡ vysokÃ½, povolenek bylo moc a cena COâ‚‚ dlouho smÄ›Å¡nÄ› nÃ­zkÃ¡. Emise klesaly pomaleji, neÅ¾ bylo potÅ™eba.\n\nğŸ“‰ Tam, kde systÃ©m zpÅ™Ã­snili a odstranili vÃ½jimky, fungoval dobÅ™e. Tam, kde povolili vÃ½jimky a politickÃ© tlaky, se stal jen sloÅ¾itÃ½m ÃºÄetnÃ­m trikem.",
        sources: ["EU ETS analysis", "European Green Deal documents"]
      },
      
      { 
        id: "activist_3", 
        type: "activist", 
        title: "AkÄnÃ­ VlÃ¡da - SystÃ©movÃ¡ ZmÄ›na", 
        location: "Lisabon", 
        x: 220, 
        y: 520,
        historicalText: "V noci nad Lisabonem svÃ­tÃ­ jen pÃ¡r lamp â€“ zbytek mÄ›sta je v ÃºspornÃ©m reÅ¾imu. UvnitÅ™ malÃ© zasedaÄky vÅ¡ak bÄ›Å¾Ã­ projektor a na stÄ›nÄ› svÃ­tÃ­ tÅ™i slova: \"KLIMA â€“ NEROVNOST â€“ EKONOMIKA\".\n\n\"PotÅ™ebujeme radikÃ¡lnÃ­ systÃ©movou zmÄ›nu napÅ™Ã­Ä celou civilizacÃ­ â€“ ekonomika, energie, potraviny, spoleÄnost. VÅ¡e je propojenÃ©. NemÅ¯Å¾eme Å™eÅ¡it klima bez Å™eÅ¡enÃ­ nerovnosti. NemÅ¯Å¾eme Å™eÅ¡it nerovnost bez transformace ekonomiky. Je to obrovskÃ½ komplexnÃ­ systÃ©m. ZmÄ›nit jeden prvek nestaÄÃ­ â€“ musÃ­me zmÄ›nit celÃ½ systÃ©m najednou!\"",
        impact2100: "ğŸŒ€ MÄ›li pravdu o propojenosti. Ale svÄ›t se snaÅ¾il Å™eÅ¡it problÃ©my izolovanÄ›. EkonomovÃ© ignorovali klima. EkologovÃ© ignorovali nerovnost. Politici Å™eÅ¡ili krÃ¡tkÃ© cykly. Nikdo nevidÄ›l celÃ½ systÃ©m. KdyÅ¾ byl jeden problÃ©m \"vyÅ™eÅ¡en\", zpÅ¯sobil to tÅ™i novÃ© problÃ©my jinde. SystÃ©m kolaboval jako domeÄek z karet.",
        fragmentValue: 3,
        minigame: {
          type: "system_change",
          startYear: 2025,
          endYear: 2050,
          rounds: 5,
          budget: 200,
          systems: {
            economy: { 
              name: "ğŸ­ Ekonomika",
              metrics: { gdp: 100, unemployment: 6, growth: 2.5 },
              targets: { gdp: "â‰¥80", unemployment: "â‰¤8", growth: "â‰¥1" }
            },
            climate: { 
              name: "ğŸŒ± Klima",
              metrics: { emissions: 100, temperature: 1.2, disasters: 5 },
              targets: { emissions: "â‰¤30", temperature: "â‰¤1.8", disasters: "â‰¤8" }
            },
            society: { 
              name: "ğŸ‘¥ SpoleÄnost",
              metrics: { inequality: 65, happiness: 60, education: 70 },
              targets: { inequality: "â‰¤40", happiness: "â‰¥70", education: "â‰¥85" }
            },
            energy: { 
              name: "âš¡ Energie",
              metrics: { renewable: 25, stability: 85, cost: 100 },
              targets: { renewable: "â‰¥80", stability: "â‰¥80", cost: "â‰¤120" }
            },
            food: { 
              name: "ğŸŒ¾ Potraviny",
              metrics: { production: 100, price: 100, security: 80 },
              targets: { production: "â‰¥95", price: "â‰¤130", security: "â‰¥90" }
            },
            ecosystem: { 
              name: "ğŸŒ EkosystÃ©my",
              metrics: { biodiversity: 70, health: 65, protected: 15 },
              targets: { biodiversity: "â‰¥60", health: "â‰¥70", protected: "â‰¥30" }
            }
          },
          policies: [
            // EKONOMICKÃ‰
            { id: 1, category: "economy", icon: "ğŸ’¼", name: "Universal Basic Income", desc: "KaÅ¾dÃ½ dostane 1000â‚¬/mÄ›sÃ­c", 
              effects: { economy: {unemployment:-3, growth:-0.5}, society: {inequality:-8, happiness:8}, climate: {emissions:2} }, 
              cost: 80, synergy: [2, 15] },
            { id: 2, category: "economy", icon: "â°", name: "4dennÃ­ tÃ½den", desc: "32 hodin/tÃ½den pro vÅ¡echny", 
              effects: { economy: {unemployment:-2, growth:-0.3}, society: {happiness:10}, climate: {emissions:-3} }, 
              cost: 20, synergy: [1] },
            { id: 3, category: "economy", icon: "ğŸ¢", name: "Kooperativy", desc: "PracovnÃ­ci vlastnÃ­ 51% firem", 
              effects: { economy: {growth:-0.2}, society: {inequality:-12, happiness:6} }, 
              cost: 15, synergy: [1, 2] },
            { id: 4, category: "economy", icon: "ğŸ’°", name: "DaÅˆ 70%", desc: "Pro pÅ™Ã­jmy nad 1 mil â‚¬", 
              effects: { economy: {growth:-0.4}, society: {inequality:-15} }, 
              cost: -30, conflict: [5] },
            { id: 5, category: "economy", icon: "ğŸ“‰", name: "Degrowth", desc: "SnÃ­Å¾it HDP o 2%/rok", 
              effects: { economy: {gdp:-10, growth:-2.5, unemployment:5}, climate: {emissions:-15}, ecosystem: {health:8} }, 
              cost: 10, conflict: [4, 6] },
            { id: 6, category: "economy", icon: "â™»ï¸", name: "CirkulÃ¡rnÃ­ 100%", desc: "ZÃ¡kaz jednorÃ¡zovÃ½ch produktÅ¯", 
              effects: { economy: {growth:-0.2, unemployment:-1}, climate: {emissions:-8}, ecosystem: {health:6} }, 
              cost: 40, synergy: [18] },
            
            // ENERGIE
            { id: 7, category: "energy", icon: "â˜€ï¸", name: "SolÃ¡r masivnÄ›", desc: "Panely vÅ¡ude", 
              effects: { energy: {renewable:15, cost:10, stability:3}, climate: {emissions:-12}, economy: {unemployment:-2} }, 
              cost: 60, synergy: [8, 9] },
            { id: 8, category: "energy", icon: "ğŸ’¨", name: "Offshore vÃ­tr", desc: "TisÃ­ce turbÃ­n v moÅ™i", 
              effects: { energy: {renewable:18, cost:12, stability:2}, climate: {emissions:-14} }, 
              cost: 70, synergy: [7, 9] },
            { id: 9, category: "energy", icon: "ğŸ”‹", name: "Mega baterie", desc: "SkladovÃ¡nÃ­ energie", 
              effects: { energy: {renewable:5, stability:15, cost:8} }, 
              cost: 50, synergy: [7, 8] },
            { id: 10, category: "energy", icon: "âš›ï¸", name: "JÃ¡dro SMR", desc: "ModulÃ¡rnÃ­ reaktory", 
              effects: { energy: {stability:12, cost:15}, climate: {emissions:-20}, society: {happiness:-8} }, 
              cost: 90, unlock: 2 },
            { id: 11, category: "energy", icon: "ğŸ­", name: "ZavÅ™Ã­t fosilnÃ­ NOW", desc: "OkamÅ¾itÄ› vÅ¡e", 
              effects: { energy: {renewable:20, cost:35, stability:-25}, climate: {emissions:-35}, economy: {unemployment:8, growth:-1.2}, society: {happiness:-15} }, 
              cost: 20, conflict: [12] },
            { id: 12, category: "energy", icon: "ğŸ•°ï¸", name: "PostupnÄ› fosilnÃ­", desc: "Do roku 2040", 
              effects: { energy: {renewable:10, cost:12, stability:-5}, climate: {emissions:-18}, economy: {unemployment:2} }, 
              cost: 30, conflict: [11] },
            
            // POTRAVINY
            { id: 13, category: "food", icon: "ğŸŒ¾", name: "RegenerativnÃ­", desc: "Obnovit pÅ¯du", 
              effects: { food: {production:-5, price:15, security:8}, climate: {emissions:-6}, ecosystem: {health:12, biodiversity:6} }, 
              cost: 35, synergy: [14, 21] },
            { id: 14, category: "food", icon: "ğŸ¥©", name: "DaÅˆ masa 200%", desc: "ZdraÅ¾it maso 3x", 
              effects: { food: {production:5, price:25}, climate: {emissions:-10}, ecosystem: {health:8}, society: {happiness:-12} }, 
              cost: -20, synergy: [13, 15] },
            { id: 15, category: "food", icon: "ğŸ§¬", name: "Lab maso", desc: "KultivovanÃ© maso", 
              effects: { food: {production:8, price:-10, security:5}, climate: {emissions:-8}, ecosystem: {biodiversity:4} }, 
              cost: 45, synergy: [14], unlock: 3 },
            { id: 16, category: "food", icon: "ğŸŒ±", name: "VertikÃ¡lnÃ­ farmy", desc: "Ve mÄ›stech", 
              effects: { food: {production:10, price:5, security:12}, climate: {emissions:-3} }, 
              cost: 55, unlock: 2 },
            { id: 17, category: "food", icon: "ğŸšœ", name: "MalÃ­ farmÃ¡Å™i", desc: "Dotace lokÃ¡lnÃ­", 
              effects: { food: {security:10, price:8}, society: {happiness:5, inequality:-3}, ecosystem: {biodiversity:5} }, 
              cost: 25, synergy: [13] },
            
            // EKOSYSTÃ‰MY
            { id: 18, category: "ecosystem", icon: "ğŸŒ³", name: "10 mld stromÅ¯", desc: "MasivnÃ­ zalesÅˆovÃ¡nÃ­", 
              effects: { ecosystem: {biodiversity:8, health:10, protected:5}, climate: {emissions:-5, disasters:-1} }, 
              cost: 40, synergy: [19, 6] },
            { id: 19, category: "ecosystem", icon: "ğŸï¸", name: "50% chrÃ¡nÄ›no", desc: "PÅ¯lka pro pÅ™Ã­rodu", 
              effects: { ecosystem: {biodiversity:15, health:12, protected:20}, food: {production:-8}, economy: {growth:-0.3} }, 
              cost: 30, synergy: [18, 20] },
            { id: 20, category: "ecosystem", icon: "ğŸ‹", name: "OceÃ¡ny regenerace", desc: "ZÃ¡kaz rybolovu", 
              effects: { ecosystem: {biodiversity:10, health:8}, food: {production:-5, security:-3}, climate: {disasters:-2} }, 
              cost: 35, synergy: [19] },
            { id: 21, category: "ecosystem", icon: "ğŸ¦‹", name: "Konec pesticidÅ¯", desc: "ZÃ¡kaz chemie", 
              effects: { ecosystem: {biodiversity:12, health:10}, food: {production:-10, price:20}, society: {happiness:5} }, 
              cost: 20, synergy: [13, 6, 2] },
            
            // SPOLEÄŒNOST
            { id: 22, category: "society", icon: "ğŸ“", name: "VzdÄ›lÃ¡nÃ­ zdarma", desc: "VÅ¡e vÄetnÄ› univerzit", 
              effects: { society: {education:15, happiness:8, inequality:-6}, economy: {unemployment:-3} }, 
              cost: 50, synergy: [23, 24] },
            { id: 23, category: "society", icon: "ğŸ¥", name: "ZdravotnictvÃ­ pro vÅ¡echny", desc: "KompletnÃ­ pÃ©Äe zdarma", 
              effects: { society: {happiness:12, inequality:-8}, economy: {growth:-0.3} }, 
              cost: 60, synergy: [22, 1] },
            { id: 24, category: "society", icon: "ğŸ˜ï¸", name: "SociÃ¡lnÃ­ bydlenÃ­", desc: "30% bytÅ¯ stÃ¡tnÃ­", 
              effects: { society: {happiness:10, inequality:-10}, economy: {unemployment:-2} }, 
              cost: 70, synergy: [1, 22] },
            { id: 25, category: "society", icon: "ğŸš†", name: "Doprava zdarma", desc: "Vlaky/busy pro vÅ¡echny", 
              effects: { society: {happiness:15, inequality:-5}, climate: {emissions:-8}, economy: {growth:-0.2} }, 
              cost: 45, synergy: [2] }
          ],
          crises: [
            { round: 2, type: "pandemic", name: "ğŸ¦  PANDEMIE", desc: "NovÃ¡ nemoc zasÃ¡hla svÄ›t", 
              effects: { economy: {gdp:-8, unemployment:4, growth:-1.5}, society: {happiness:-10} } },
            { round: 3, type: "drought", name: "ğŸ”¥ MEGA SUCHO", desc: "NejhorÅ¡Ã­ sucho za 500 let", 
              effects: { food: {production:-15, price:30, security:-12}, climate: {disasters:3}, ecosystem: {health:-8} } },
            { round: 4, type: "recession", name: "ğŸ’¸ KRIZE", desc: "GlobÃ¡lnÃ­ recese", 
              effects: { economy: {gdp:-12, unemployment:6, growth:-2}, society: {happiness:-8} } },
            { round: 2, type: "breakthrough", name: "ğŸŒŸ PRÅ®LOM", desc: "LevnÃ© baterie!", 
              effects: { energy: {cost:-20, renewable:8}, economy: {growth:0.8} } },
            { round: 3, type: "revolution", name: "âœŠ POVSTÃNÃ", desc: "Protesty za spravedlnost", 
              effects: { society: {happiness:15, inequality:-5}, economy: {growth:-0.5} } }
          ]
        },
        sources: ["Systems Thinking", "Limits to Growth", "Doughnut Economics", "IPCC AR6"]
      },
      { 
        id: "activist_4", 
        type: "activist", 
        title: "DenÃ­k Adriany - Komunikace je klÃ­Ä", 
        location: "Madrid", 
        x: 300, 
        y: 530,
        historicalText: "Z asfaltu v Madridu sÃ¡lÃ¡ veÄer teplo jako z rozÅ¾havenÃ© plotny. Na nÃ¡mÄ›stÃ­ stojÃ­ tisÃ­ce lidÃ­ s transparenty â€“ ÄÃ¡st Å¾Ã¡dÃ¡ radikÃ¡lnÃ­ klimatickÃ¡ opatÅ™enÃ­, ÄÃ¡st skanduje proti â€ekofanatikÅ¯mâ€œ.\n\n\"PÅ™estÄ›hovala jsem se z Granady, kde uÅ¾ nenÃ­ k Å¾itÃ­. Horko je nesnesitelnÃ©. Dnes jsme protestovali pÅ™ed parlamentem â€“ 50 000 lidÃ­. NÄ›kteÅ™Ã­ aktivistÃ© jsou fanatiÄtÃ­, lepÃ­ se na silnice, niÄÃ­ umÄ›nÃ­. JÃ¡ chÃ¡pu jejich zoufalstvÃ­, ale takhle jen polarizujeme spoleÄnost.\n\nLidÃ© na nÃ¡s kÅ™iÄÃ­ 'ekoteroristÃ©!'. Nikdo nenaslouchÃ¡. Nikdo nekomunikuje. HÃ¡zejÃ­ nÃ¡s vÅ¡echny do jednoho pytle. PotÅ™ebujeme dialog, ne konfrontaci. PotÅ™ebujeme porozumÄ›nÃ­, ne nenÃ¡vist. NÃ¡Å¡ cÃ­l je pÅ™ece spoleÄnÃ½ â€“ aby naÅ¡e dÄ›ti Å¾ily v bezpeÄnÃ©m svÄ›tÄ›. ProÄ to ostatnÃ­ nevidÃ­? ProÄ nemÅ¯Å¾eme mluvit jako lidÃ©, ne jako nepÅ™Ã¡telÃ©?\"",
        impact2100: "ğŸ’” Polarizace zvÃ­tÄ›zila nad dialogem. SpoleÄnost se rozÅ¡tÄ›pila na tÃ¡bory, kterÃ© spolu pÅ™estaly komunikovat. AktivistÃ© byli dÃ©monizovÃ¡ni. UmÃ­rnÄ›nÃ­ aktivistÃ© jako Adriana byli umlÄeni vlastnÃ­mi radikÃ¡ly i odpÅ¯rci. Bez dialogu nepÅ™iÅ¡la Å¾Ã¡dnÃ¡ zmÄ›na. Adriana zemÅ™ela v roce 2067 pÅ™i klimatickÃ© vlnÄ› veder v Madridu, kterÃ©mu se jiÅ¾ Å™Ã­kalo \"SaharskÃ© mÄ›sto\". MÄ›la pravdu â€“ komunikace byla klÃ­Äem, kterÃ½ jsme nikdy nepouÅ¾ili.",
        minigame: { type: "simple_quiz" },
        sources: ["Climate activism research", "Polarization studies", "Communication theory"]
      },
      { 
        id: "activist_5", 
        type: "activist", 
        title: "ğŸ™ï¸ Audio / video zÃ¡znam - Pierre Dubois, vinaÅ™", 
        location: "Provence", 
        x: 420, 
        y: 490,
        historicalText: "ChÃ¡pete jÃ­dlo jako bÄ›Å¾nÃ© zboÅ¾Ã­, kterÃ© by mÄ›lo bÃ½t co nejlevnÄ›jÅ¡Ã­? Podle Jeana Matthieu ThÃ©venota, ekologickÃ©ho zemÄ›dÄ›lce a zÃ¡stupce evropskÃ½ch malÃ½ch farmÃ¡Å™Å¯ (ECVC), je to zÃ¡sadnÃ­ omyl: â€VÅ¾dy jsme Å™Ã­kali, Å¾e jÃ­dlo nenÃ­ komodita. JÃ­dlo je zÃ¡kladem Å¾ivota,â€œ Å™Ã­kÃ¡. Proto by podle nÄ›j â€nemÄ›lo bÃ½t zahrnuto do systÃ©mu SvÄ›tovÃ© obchodnÃ­ organizace ani do jakÃ©koli dohody o volnÃ©m obchodu,â€œ protoÅ¾e to nenÃ­ auto ani poÄÃ­taÄ. V tomto poutavÃ©m zÃ¡znamu rozhovoru odhaluje ThÃ©venot, proÄ jsou evropÅ¡tÃ­ farmÃ¡Å™i prvnÃ­, koho dopadajÃ­ zmÄ›ny klimatu i pesticidy, a jak je prÅ¯mysl manipuluje, aby se postavili proti ekologÅ¯m.",
        impact2100: "Jean Matthieu ThÃ©venot, ekologickÃ½ farmÃ¡Å™ zastÃ¡vÃ¡ fundamentÃ¡lnÃ­ princip, Å¾e potraviny nejsou komodita a nemÄ›ly by bÃ½t zahrnuty do systÃ©mu SvÄ›tovÃ© obchodnÃ­ organizace (WTO) ani do Å¾Ã¡dnÃ© dohody o volnÃ©m obchodu, protoÅ¾e jÃ­dlo je zÃ¡kladem Å¾ivota a ne auto Äi poÄÃ­taÄ. ThÃ©venot tvrdÃ­, Å¾e souÄasnÃ½ systÃ©m kapitalismu a volnÃ©ho obchodu zvÃ½hodÅˆuje nadnÃ¡rodnÃ­ spoleÄnosti a vytvÃ¡Å™Ã­ â€faleÅ¡nÃ½ sporâ€œ mezi farmÃ¡Å™i a ekology, pÅ™iÄemÅ¾ farmÃ¡Å™i, kteÅ™Ã­ jsou prvnÃ­ zasaÅ¾eni pesticidy a klimatickÃ½mi zmÄ›nami, platÃ­ cenu systÃ©mu v podobÄ› velmi nÃ­zkÃ½ch pÅ™Ã­jmÅ¯. SystÃ©movou zmÄ›nu je moÅ¾nÃ© dosÃ¡hnout prostÅ™ednictvÃ­m stanovenÃ­ minimÃ¡lnÃ­ch cen a zÃ¡kazem dovozu, kterÃ½ nedodrÅ¾uje evropskÃ© standardy, a zavedenÃ­m intervenÄnÃ­ho stanovenÃ­ cen ze strany vlÃ¡d, kterÃ© by nutilo supermarkety nakupovat dovÃ¡Å¾enÃ© zboÅ¾Ã­ za stejnou cenu jako lokÃ¡lnÃ­.",
        mediaUrl: "https://drive.google.com/file/d/1oBKtQeCOVtRG0CA6FeooDcseVvkLzC1N/preview",
        mediaLabel: "Audio / video zÃ¡znam z Provence",
        minigame: { type: "provence_quiz" },
        sources: ["Nature: Mediterranean agriculture collapse", "IPCC AR6 Regional Chapter Europe", "Climate impact on viticulture"]
      },
      { 
        id: "scientist_3", 
        type: "scientist", 
        title: "ğŸ“¹ Video: PoslednÃ­ den Lauwersogu", 
        location: "Lauwersoog", 
        x: 520, 
        y: 200,
        historicalText: "PonoÅ™te se do vizionÃ¡Å™skÃ©ho pÅ™Ã­stupu Nizozemska k boji proti dÅ¯sledkÅ¯m klimatickÃ© zmÄ›ny â€“ zejmÃ©na proti zrychlujÃ­cÃ­mu se stoupÃ¡nÃ­ hladiny moÅ™e. Toto video nabÃ­zÃ­ vhled do Å¡piÄkovÃ©ho vÃ½zkumu a inovativnÃ­ch projektÅ¯, kterÃ© se snaÅ¾Ã­ zajistit dlouhodobou bezpeÄnost tÃ©to nÃ­Å¾innÃ© zemÄ›. Riziko povodnÃ­ se zvyÅ¡uje: Nizozemsko je globÃ¡lnÃ­ Å¡piÄkou v managementu pobÅ™eÅ¾nÃ­ ochrany, ale riziko povodnÃ­ stoupÃ¡. Voda, kterou dnes vidÃ­me jen jednou za stoletÃ­, se do konce tohoto stoletÃ­ mÅ¯Å¾e objevovat kaÅ¾dÃ© dva aÅ¾ deset let. KlimatoloÅ¾ka Amay Slongan (spoluautorka zprÃ¡vy OSN o zmÄ›nÄ› klimatu z roku 2021) upozorÅˆuje, Å¾e hladina moÅ™e mÅ¯Å¾e do poloviny stoletÃ­ stoupnout v prÅ¯mÄ›ru o 25 centimetrÅ¯.\nÄŒas hraje roli: VÄ›dci zdÅ¯razÅˆujÃ­, Å¾e aÄkoli je dnes nizozemskÃ¡ Delta jednou z nejlÃ©pe chrÃ¡nÄ›nÃ½ch na svÄ›tÄ›, je nutnÃ© zaÄÃ­t s vÃ½zkumem a Ãºpravami ihned. Procesy, jako je vytvÃ¡Å™enÃ­ ochrannÃ½ch slanisek, jsou pomalÃ© a â€pokud bychom Äekali do let 2050 aÅ¾ 2100, nezbyl by Äas na Ãºpravu systÃ©mu.\"",
        impact2100: "ğŸŒŠ Lauwersoog byl opuÅ¡tÄ›n v roce 2073 po katastrofÃ¡lnÃ­ povodni. HrÃ¡ze selhaly pÅ™i nÃ¡rÅ¯stu hladiny o 2.8 metru. Amsterdam mÃ¡ nynÃ­ 18metrovÃ© protipovodÅˆovÃ© zdi, ale vÄ›tÅ¡ina pobÅ™eÅ¾nÃ­ho Nizozemska je pod vodou. 8 milionÅ¯ NizozemcÅ¯ bylo evakuovÃ¡no â€“ nejvÄ›tÅ¡Ã­ klimatickÃ¡ migrace v EvropÄ›. Dr. van Dijk mÄ›la pravdu â€“ antarktickÃ½ ledovec kolaboval rychleji neÅ¾ modely pÅ™edpovÃ­daly. NizozemskÃ© inÅ¾enÃ½rstvÃ­, tisÃ­c let zkuÅ¡enostÃ­, nebylo dost proti tomu, co jsme rozpoutali. Ti, co zachytili toto video, dokumentovali konec jednÃ© civilizace.",
        minigame: { type: "simple_quiz" },
        mediaType: "video",
        mediaUrl: "https://drive.google.com/file/d/1oCeoKx2s1ZnMi7qP4BXN0Bz7QkoH_zYN/preview",
        mediaLabel: "Video z Lauwersogu (Google Drive)",
        sources: ["IPCC AR6 Sea Level Rise", "Netherlands Delta Programme", "Antarctic ice sheet studies"]
      },
      { 
        id: "denier_3", 
        type: "denier", 
        title: "Corriere della Sera - PolitickÃ½ Odpor", 
        location: "Å˜Ã­m", 
        x: 580, 
        y: 600,
        historicalText: "LetnÃ­ Å˜Ã­m, rozpÃ¡lenÃ© ulice a klimatizovanÃ© kancelÃ¡Å™e. V jednÃ© z nich prÃ¡vÄ› vznikÃ¡ ÄlÃ¡nek, kterÃ½ pobÄ›Å¾Ã­ na titulnÃ­ stranÄ›.\n\nğŸ“° CORRIERE DELLA SERA â€“ 15. bÅ™ezna 2025\n\n\"KLIMATICKÃ AGENDA JE ÃšTOK NA ITALSKÃ PRÅ®MYSL\" â€“ VicepremiÃ©r\n\n\"Green Deal je bruselskÃ¡ diktatura, kterÃ¡ chce zniÄit naÅ¡e automobilky, naÅ¡e zemÄ›dÄ›lstvÃ­, nÃ¡Å¡ zpÅ¯sob Å¾ivota,\" prohlÃ¡sil dnes na tiskovÃ© konferenci vicepremiÃ©r.\n\n\"KlimatickÃ¡ zmÄ›na? Planeta se vÅ¾dy mÄ›nila. Toto je politickÃ½ vÃ½mysl EvropskÃ© unie, kterÃ¡ chce ovlÃ¡dat suverÃ©nnÃ­ stÃ¡ty. Nebudeme se klanÄ›t Bruselu!\"\n\nNa protivlÃ¡dnÃ­ch demonstracÃ­ch v Å˜Ã­mÄ› dnes policie zasahovala slznÃ½m plynem. TisÃ­ce ItalÅ¯ protestujÃ­ proti 'ekologickÃ© tyranii'.\n\nOpozice: \"Tento klimatickÃ½ populismus odklÃ¡dÃ¡ nutnou transformaci. NÃ¡sledky budou katastrofÃ¡lnÃ­.\"\n\nSpoleÄnost je hluboce rozdÄ›lenÃ¡. Situace eskaluje.",
        impact2100: "ğŸ”¥ ItÃ¡lie byla mezi prvnÃ­mi evropskÃ½mi zemÄ›mi, kterÃ© se staly neobyvatelnÃ©. Teploty v lÃ©tÄ› pravidelnÄ› pÅ™esahovaly 50 Â°C. Å˜Ã­m byl opuÅ¡tÄ›n v roce 2071. PolitickÃ½ odpor zpozdil transformaci o kritickÃ½ch 15 let. ItalskÃ½ prÅ¯mysl byl zniÄen â€“ ne klimatickÃ½mi opatÅ™enÃ­mi, ale klimatem samotnÃ½m. TovÃ¡rny, kterÃ© \"chrÃ¡nili\" pÅ™ed regulacemi, skonÄily pod vodou nebo v plamenech. Politici, kteÅ™Ã­ varovali pÅ™ed 'bruselskou diktaturou', uprchli do Å¡vÃ½carskÃ½ch Alp. VicepremiÃ©r zemÅ™el v roce 2069 pÅ™i povodnÃ­ch v MilÃ¡nÄ›.",
        minigame: { type: "simple_quiz" },
        sources: ["EU policy resistance studies", "Political polarization in climate action", "Italian climate politics"]
      },
      { 
        id: "elite_5", 
        type: "elite", 
        title: "Energiewende Paradox - NÄ›meckÃ¡ EnergetickÃ¡ Krize", 
        location: "BerlÃ­n", 
        x: 550, 
        y: 270,
        historicalText: "V bruselskÃ½ch kancelÃ¡Å™Ã­ch se rodil Green Deal, ale v nÄ›meckÃ½ch uhelnÃ½ch regionech se rodil hnÄ›v. Na jednÃ© stranÄ› prezentace o udrÅ¾itelnÃ© budoucnosti, na druhÃ© stranÄ› hornÃ­ci, kteÅ™Ã­ nevidÄ›li pro svÅ¯j region Å¾Ã¡dnou alternativu.\n\nGreen Deal byl ambiciÃ³znÃ­: klimatickÃ¡ neutralita do roku 2050, 55% snÃ­Å¾enÃ­ emisÃ­ do roku 2030, transformace energetiky, dopravy, zemÄ›dÄ›lstvÃ­. Ale selhala komunikace. LidÃ© nerozumÄ›li, proÄ. Selhalo vysvÄ›tlovÃ¡nÃ­. Brusel mluvil technokraticky, ne lidsky.\n\nSelhala zahraniÄnÃ­ politika â€“ zÃ¡vislost na ruskÃ©m plynu pÅ™etrvala. NÄ›kterÃ© stÃ¡ty bojkotovaly: Polsko, MaÄarsko, pozdÄ›ji ItÃ¡lie. Å˜Ã­zenÃ­ shora nefungovalo â€“ regiony a mÄ›sta nemÄ›ly pravomoci. PrÅ¯mysl loboval proti kaÅ¾dÃ© zmÄ›nÄ›. A hlavnÄ› â€“ chybÄ›la spravedlivÃ¡ transformace. DÄ›lnÃ­ci v uhelnÃ½ch oblastech byli opuÅ¡tÄ›ni.\n\nV roce 2035 jsme splnili pouze 40 % cÃ­lÅ¯. Bylo uÅ¾ pozdÄ›.",
        impact2100: "âš–ï¸ Green Deal mohl zachrÃ¡nit Evropu. MÄ›l sprÃ¡vnÃ© cÃ­le. Ale zpÅ¯sob implementace selhal. TechnokratickÃ© Å™Ã­zenÃ­ shora vs. demokratickÃ½ dialog zdola. ZÃ¡vislost na autoritÃ¡Å™skÃ½ch reÅ¾imech. NedostateÄnÃ¡ komunikace. Absence spravedlnosti. VÃ½sledek: Emise pokraÄovaly, cÃ­le nesplnÄ›ny, Evropa rozdÄ›lenÃ¡, transformace neÃºplnÃ¡. Bylo to \"pÅ™Ã­liÅ¡ mÃ¡lo, pÅ™Ã­liÅ¡ pozdÄ›\" â€“ ne proto, Å¾e Green Deal byl Å¡patnÃ½, ale proto, Å¾e nebyl sprÃ¡vnÄ› implementovÃ¡n.",
        sources: ["European Green Deal official documents", "EEA reports", "EU climate policy analysis"]
      }
    ];

    const WORLD_WIDTH = 1400;
    const WORLD_HEIGHT = 900;

    let canvas, ctx, player, fragments, camera, keys, gameState, collectedFragments, currentFragment;

    async function onConfigChange(config) {
      document.body.style.background = `linear-gradient(135deg, ${config.background_color || defaultConfig.background_color} 0%, ${config.surface_color || defaultConfig.surface_color} 100%)`;
    }

    const capabilities = {
      recolorables: [
        {
          get: () => window.elementSdk?.config?.background_color || defaultConfig.background_color,
          set: (value) => {
            if (window.elementSdk?.config) {
              window.elementSdk.config.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          }
        },
        {
          get: () => window.elementSdk?.config?.surface_color || defaultConfig.surface_color,
          set: (value) => {
            if (window.elementSdk?.config) {
              window.elementSdk.config.surface_color = value;
              window.elementSdk.setConfig({ surface_color: value });
            }
          }
        },
        {
          get: () => window.elementSdk?.config?.text_color || defaultConfig.text_color,
          set: (value) => {
            if (window.elementSdk?.config) {
              window.elementSdk.config.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          }
        },
        {
          get: () => window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color,
          set: (value) => {
            if (window.elementSdk?.config) {
              window.elementSdk.config.primary_action_color = value;
              window.elementSdk.setConfig({ primary_action_color: value });
            }
          }
        },
        {
          get: () => window.elementSdk?.config?.secondary_action_color || defaultConfig.secondary_action_color,
          set: (value) => {
            if (window.elementSdk?.config) {
              window.elementSdk.config.secondary_action_color = value;
              window.elementSdk.setConfig({ secondary_action_color: value });
            }
          }
        }
      ],
      borderables: [],
      fontEditable: undefined,
      fontSizeable: undefined
    };

    function mapToCapabilities(config) {
      return capabilities;
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["game_title", config.game_title || defaultConfig.game_title],
        ["welcome_message", config.welcome_message || defaultConfig.welcome_message],
        ["final_message", config.final_message || defaultConfig.final_message]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    function init() {
      canvas = document.getElementById('gameCanvas');
      if (!canvas) return;
      ctx = canvas.getContext('2d');
      
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      player = { 
        x: WORLD_WIDTH / 2, 
        y: WORLD_HEIGHT / 2, 
        size: 20,
        speed: 200
      };
      
      camera = { x: 0, y: 0 };
      keys = {};
      gameState = 'playing';
      collectedFragments = [];
      currentFragment = null;

      fragments = FRAGMENTS.map(f => ({
        ...f,
        collected: false,
        pulse: Math.random() * Math.PI * 2
      }));

      document.addEventListener('keydown', handleKeyDown);
      document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

      setupMobileControls();

      showWelcomeModal();
      gameLoop();

      showWelcomeModal();
      gameLoop();
    }

    // âœ… OPRAVA: plÃ¡tno se vÅ¾dy roztÃ¡hne na okno
    function resizeCanvas() {
      if (!canvas) return;
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    function handleKeyDown(e) {
      const key = e.key.toLowerCase();
      keys[key] = true;

      if (key === 'e' && gameState === 'playing') {
        const nearestFragment = getNearestFragment();
        if (nearestFragment && nearestFragment.distance < 60 && !nearestFragment.collected) {
          showFragmentModal(nearestFragment);
        }
      }
    }

    function showWelcomeModal() {
      const config = window.elementSdk?.config || defaultConfig;
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <h2>ğŸŒ ${config.game_title}</h2>
          <p style="font-size: 16px; line-height: 1.8; white-space: pre-wrap;">${config.welcome_message}</p>
          <p style="margin-top: 20px; font-size: 16px;">ğŸ“° <strong>POSLEDNÃ ZPRÃVY Z ROKU 2100:</strong></p>
          <ul style="font-size: 16px; line-height: 1.8;">
            <li>GlobÃ¡lnÃ­ teplota: +2.8 Â°C</li>
            <li>Hladina moÅ™Ã­: +1.2 metru</li>
            <li>KlimatickÃ½ch uprchlÃ­kÅ¯: 2.1 miliardy</li>
            <li>VyhynulÃ½ch druhÅ¯: 35 %</li>
            <li>PoslednÃ­ ledovec: 2061</li>
          </ul>
          <p style="margin-top: 20px; font-size: 16px;">ğŸ¯ <strong>VaÅ¡e mise:</strong> Prozkoumejte zpustoÅ¡enou Evropu a najdÄ›te 11 fragmentÅ¯ historie z roku 2025. KaÅ¾dÃ½ fragment odhaluje, proÄ jsme selhali.</p>
          <button class="button" onclick="closeModal()">ZaÄÃ­t misi</button>
        </div>
      `;
      document.getElementById('modalContainer').appendChild(modal);
    }

    function renderMedia(fragmentData) {
      if (!fragmentData || !fragmentData.mediaUrl) return '';
      const label = fragmentData.mediaLabel || 'ZÃ¡znam';
      return `
        <h3>ğŸ¥ ${label}:</h3>
        <div style="margin: 10px 0 25px 0; text-align:center;">
          <iframe src="${fragmentData.mediaUrl}" width="560" height="315" style="max-width:100%; border:0;" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
      `;
    }

    function showFragmentModal(fragment) {
      currentFragment = fragment;
      const fragmentData = FRAGMENTS.find(f => f.id === fragment.id);
      
      const typeIcons = {
        elite: 'ğŸ‘”',
        denier: 'ğŸš«',
        scientist: 'ğŸ”¬',
        activist: 'ğŸ“¢'
      };

      const typeLabels = {
        elite: 'ELITY',
        denier: 'POPÃRAÄŒI',
        scientist: 'VÄšDCI',
        activist: 'AKTIVISTÃ‰'
      };

      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <h2>${typeIcons[fragmentData.type]} ${fragmentData.title}</h2>
          <div class="fragment-badge badge-${fragmentData.type}">
            ${fragmentData.location} | ${typeLabels[fragmentData.type]}
          </div>
          
          <h3>ğŸ“œ HistorickÃ½ zÃ¡znam (2025):</h3>
          <p style="font-size: 16px; line-height: 1.8; white-space: pre-wrap;">${fragmentData.historicalText}</p>
          
          ${renderMedia(fragmentData)}
          
          ${renderMinigame(fragmentData.minigame)}
          
          <div class="impact-box">
            <h3>âš ï¸ DOPAD v roce 2100:</h3>
            <p style="font-size: 16px; line-height: 1.6; white-space: pre-wrap;">${fragmentData.impact2100}</p>
          </div>
          
          <div class="sources">
            <strong>ğŸ“š VÄ›deckÃ© zdroje:</strong><br>
            ${fragmentData.sources.map(s => `â€¢ ${s}`).join('<br>')}
          </div>
          
          <div id="fragmentActions">
            <button class="button" id="collectBtn" onclick="collectCurrentFragment()">SesbÃ­rat fragment</button>
            <button class="button button-secondary" onclick="closeModal()">ZavÅ™Ã­t</button>
          </div>
        </div>
      `;
      document.getElementById('modalContainer').appendChild(modal);

      if (fragmentData.minigame && fragmentData.minigame.type === 'system_change') {
        setTimeout(() => initSystemChange(), 100);
      }
      
      if (fragmentData.minigame && fragmentData.minigame.type === 'norway_ev_transition') {
        setTimeout(() => initNorwayGame(), 100);
      }
    }
    
    // NORWAY EV GAME
    let norwayState = null;
    
    function initNorwayGame() {
      const fragment = FRAGMENTS.find(f => f.id === currentFragment.id);
      if (!fragment || !fragment.minigame || fragment.minigame.type !== 'norway_ev_transition') return;
      
      const mg = fragment.minigame;
      norwayState = {
        budget: mg.budget,
        selectedPolicies: [],
        policies: mg.policies
      };
      
      renderNorwayPolicies();
    }
    
    function renderNorwayPolicies() {
      const container = document.getElementById('norwayPolicies');
      if (!container || !norwayState) return;
      
      container.innerHTML = norwayState.policies.map(policy => `
        <div style="background: rgba(0, 136, 255, 0.15); border: 2px solid #0088ff; padding: 12px; border-radius: 6px; cursor: pointer; transition: all 0.3s;" 
             class="norway-policy-card" 
             data-policy-id="${policy.id}"
             onclick="toggleNorwayPolicy(${policy.id})">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <div style="font-weight: bold; font-size: 14px;">${policy.name}</div>
            <div style="font-size: 20px;">â˜</div>
          </div>
          <div style="font-size: 12px; opacity: 0.9; margin-bottom: 8px;">${policy.desc}</div>
          <div style="display: flex; justify-content: space-between; font-size: 11px;">
            <span style="color: ${policy.cost > 0 ? '#ff4444' : '#00ff88'};">
              ${policy.cost > 0 ? '-' : '+'}${Math.abs(policy.cost)} mld â‚¬
            </span>
            <span style="color: #00ff88;">+${policy.effect}% EV</span>
          </div>
        </div>
      `).join('');
    }
    
    window.toggleNorwayPolicy = function(policyId) {
      if (!norwayState) return;
      
      const index = norwayState.selectedPolicies.indexOf(policyId);
      const card = document.querySelector(`[data-policy-id="${policyId}"]`);
      
      if (index > -1) {
        norwayState.selectedPolicies.splice(index, 1);
        card.style.background = 'rgba(0, 136, 255, 0.15)';
        card.style.borderColor = '#0088ff';
        card.querySelector('div[style*="font-size: 20px"]').textContent = 'â˜';
      } else {
        norwayState.selectedPolicies.push(policyId);
        card.style.background = 'rgba(0, 255, 136, 0.25)';
        card.style.borderColor = '#00ff88';
        card.querySelector('div[style*="font-size: 20px"]').textContent = 'â˜‘';
      }
      
      updateNorwayDisplay();
    };
    
    function updateNorwayDisplay() {
      if (!norwayState) return;
      
      let totalCost = 0;
      let totalEffect = 0;
      
      norwayState.selectedPolicies.forEach(id => {
        const policy = norwayState.policies.find(p => p.id === id);
        totalCost += policy.cost;
        totalEffect += policy.effect;
      });
      
      const remainingBudget = norwayState.budget - totalCost;
      
      const budgetEl = document.getElementById('norwayBudget');
      const evEl = document.getElementById('norwayEVPercent');
      const progressEl = document.getElementById('norwayProgress');

      if (!budgetEl || !evEl || !progressEl) return;
      
      budgetEl.textContent = `${remainingBudget} mld â‚¬`;
      budgetEl.style.color = remainingBudget < 0 ? '#ff4444' : '#00ff88';
      
      const evPercent = Math.min(totalEffect, 100);
      evEl.textContent = `${evPercent}%`;
      progressEl.style.width = `${evPercent}%`;
    }
    
    window.calculateNorwayResult = function() {
      if (!norwayState) return;
      
      let totalCost = 0;
      let totalEffect = 0;
      
      norwayState.selectedPolicies.forEach(id => {
        const policy = norwayState.policies.find(p => p.id === id);
        totalCost += policy.cost;
        totalEffect += policy.effect;
      });
      
      const remainingBudget = norwayState.budget - totalCost;
      const resultDiv = document.getElementById('norwayResult');
      
      if (!resultDiv) return;

      if (remainingBudget < 0) {
        resultDiv.innerHTML = `
          <div style="background: rgba(255, 68, 68, 0.2); border: 2px solid #ff4444; padding: 20px; border-radius: 8px;">
            <h3 style="color: #ff4444; margin: 0 0 10px 0;">ğŸ’¸ ROZPOÄŒET PÅ˜EKROÄŒEN</h3>
            <p>PÅ™ekroÄili jste rozpoÄet o ${Math.abs(remainingBudget)} mld â‚¬. Vyberte levnÄ›jÅ¡Ã­ politiky.</p>
          </div>
        `;
        return;
      }
      
      if (totalEffect >= 100) {
        resultDiv.innerHTML = `
          <div style="background: rgba(0, 255, 136, 0.2); border: 2px solid #00ff88; padding: 25px; border-radius: 8px;">
            <h3 style="color: #00ff88; margin: 0 0 15px 0;">âœ… TRANSFORMACE ÃšSPÄšÅ NÃ!</h3>
            <p style="font-size: 16px; line-height: 1.6;">
              DosÃ¡hli jste 100 % elektromobility! NorskÃ½ model funguje:
            </p>
            <ul style="font-size: 15px; line-height: 1.8;">
              <li>âœ… Kombinace pobÃ­dek (mrkviÄky) a danÃ­ (biÄe)</li>
              <li>âœ… Investice do infrastruktury</li>
              <li>âœ… DlouhodobÃ¡ vize napÅ™Ã­Ä politickÃ½m spektrem</li>
              <li>âœ… VyuÅ¾itÃ­ pÅ™Ã­rodnÃ­ho bohatstvÃ­ pro transformaci</li>
            </ul>
            <p style="margin-top: 15px; font-size: 14px; opacity: 0.9;">
              ğŸ’¡ KlÃ­ÄovÃ¡ lekce: Transformace je moÅ¾nÃ¡, pokud jsou sprÃ¡vnÃ© politiky a politickÃ¡ vÅ¯le.
            </p>
          </div>
        `;
        
        const collectBtn = document.getElementById('collectBtn');
        if (collectBtn) {
          collectBtn.style.display = 'inline-block';
          collectBtn.disabled = false;
        }
        
        const calcBtn = document.getElementById('norwayCalculateBtn');
        if (calcBtn) calcBtn.disabled = true;
      } else {
        resultDiv.innerHTML = `
          <div style="background: rgba(255, 165, 0, 0.2); border: 2px solid #ffa500; padding: 20px; border-radius: 8px;">
            <h3 style="color: #ffa500; margin: 0 0 10px 0;">âš ï¸ ÄŒÃSTEÄŒNÃ ÃšSPÄšCH</h3>
            <p>DosÃ¡hli jste pouze ${totalEffect}% EV. PotÅ™ebujete vÃ­ce politik nebo efektivnÄ›jÅ¡Ã­ kombinaci.</p>
            <p style="margin-top: 10px; font-size: 14px;">ğŸ’¡ Tip: NÄ›kterÃ© politiky se vzÃ¡jemnÄ› posilujÃ­.</p>
          </div>
        `;
      }
    };
    
    // SYSTEM CHANGE GAME
    let systemState = null;
    let currentFilter = 'all';

    function renderMinigame(minigame) {
      if (!minigame) return '';

      if (minigame.type === 'norway_ev_transition') {
        return `
          <div class="minigame-container">
            <h3>ğŸ® Minihra: NorskÃ¡ Transformace na Elektromobilitu</h3>
            <p style="font-size: 14px; margin: 10px 0;">
              CÃ­l: DosÃ¡hnout 100 % elektromobilÅ¯ do roku 2035. RozpoÄet: ${minigame.budget} mld â‚¬
            </p>
            
            <div style="background: rgba(0, 136, 255, 0.15); padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid #0088ff;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div>
                  <div style="font-size: 18px; font-weight: bold;">ğŸ“Š PodÃ­l EV:</div>
                  <div style="font-size: 32px; font-weight: bold; color: #00ff88;" id="norwayEVPercent">0%</div>
                </div>
                <div>
                  <div style="font-size: 18px; font-weight: bold;">ğŸ’° ZbÃ½vÃ¡:</div>
                  <div style="font-size: 32px; font-weight: bold;" id="norwayBudget">${minigame.budget} mld â‚¬</div>
                </div>
              </div>
              <div style="background: rgba(0,0,0,0.3); height: 30px; border-radius: 15px; overflow: hidden;">
                <div id="norwayProgress" style="height: 100%; background: linear-gradient(90deg, #00ff88, #00cc6a); width: 0%; transition: width 0.5s;"></div>
              </div>
            </div>
            
            <h4>ğŸ”§ Vyberte politiky (mÅ¯Å¾ete kombinovat):</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 12px; margin: 20px 0;" id="norwayPolicies"></div>
            
            <div id="norwayResult" style="margin: 20px 0;"></div>
            
            <div style="text-align: center;">
              <button class="button" onclick="calculateNorwayResult()" id="norwayCalculateBtn">
                SpoÄÃ­tat vÃ½sledek
              </button>
            </div>
          </div>
        `;
      }
      
      if (minigame.type === 'system_change') {
        return `
          <div class="minigame-container">
            <h3>ğŸ® Minihra: SystÃ©movÃ¡ ZmÄ›na 2025â€“2050</h3>
            <p style="font-size: 14px; margin: 10px 0;">Transformujte celou civilizaci za 25 let! VÅ¡e je propojenÃ© â€“ kaÅ¾dÃ¡ politika ovlivÅˆuje vÅ¡echny systÃ©my. CÃ­l: DosÃ¡hnout vÅ¡ech target hodnot do roku 2050.</p>
            
            <div class="round-info" id="systemRoundInfo">
              ğŸ“… ROK 2025 | KOLO 1/5 | RozpoÄet: 200 mld â‚¬
            </div>

            <div class="system-dashboard" id="systemDashboard"></div>

            <div class="category-filter" id="categoryFilter">
              <div class="filter-btn active" data-cat="all" onclick="filterPolicies('all')">ğŸŒ VÅ¡e</div>
              <div class="filter-btn" data-cat="economy" onclick="filterPolicies('economy')">ğŸ­ Ekonomika</div>
              <div class="filter-btn" data-cat="energy" onclick="filterPolicies('energy')">âš¡ Energie</div>
              <div class="filter-btn" data-cat="food" onclick="filterPolicies('food')">ğŸŒ¾ Potraviny</div>
              <div class="filter-btn" data-cat="ecosystem" onclick="filterPolicies('ecosystem')">ğŸŒ EkosystÃ©my</div>
              <div class="filter-btn" data-cat="society" onclick="filterPolicies('society')">ğŸ‘¥ SpoleÄnost</div>
            </div>

            <div class="policies-grid" id="systemPoliciesGrid"></div>

            <div id="crisisContainer"></div>

            <div style="text-align: center; margin: 20px 0;">
              <button class="button" onclick="advanceSystemRound()" id="systemAdvanceBtn">
                PokraÄovat do dalÅ¡Ã­ho obdobÃ­ (5 let) âœ
              </button>
            </div>

            <div id="systemResult"></div>
          </div>
        `;
      }

      if (minigame.type === 'provence_quiz') {
        return `
          <div class="minigame-container">
            <h3>ğŸ® Minihra: KvÃ­z â€“ RozumÃ­Å¡ pÅ™Ã­bÄ›hu?</h3>
            <p style="font-size: 14px; margin: 10px 0;">
              OdpovÄ›z na otÃ¡zky k pÅ™Ã­bÄ›hu (audio/video zÃ¡znam). Potom klikni na â€Vyhodnotit kvÃ­zâ€œ.
            </p>

            <ol style="font-size: 14px; line-height: 1.7; padding-left: 20px;">
              <li style="margin-bottom: 12px;">
                Kdo je podle Jeana Matthieu ThÃ©venota skuteÄnÃ½m protivnÃ­kem malÃ½ch farmÃ¡Å™Å¯, jehoÅ¾ vliv vede k mylnÃ©mu vnÃ­mÃ¡nÃ­ konfliktu mezi farmÃ¡Å™i a ekology?
                <div style="margin-top: 6px;">
                  <label><input type="radio" name="prov_q1" value="A"> SpotÅ™ebitelÃ© poÅ¾adujÃ­ levnÃ© potraviny</label><br>
                  <label><input type="radio" name="prov_q1" value="B"> VlÃ¡dy a instituce EvropskÃ© unie</label><br>
                  <label><input type="radio" name="prov_q1" value="C"> VelkÃ½ zemÄ›dÄ›lskÃ½ prÅ¯mysl (agroprÅ¯mysl)</label>
                </div>
              </li>
              <li style="margin-bottom: 12px;">
                JakÃ© Å™eÅ¡enÃ­ navrhuje Jean Matthieu ThÃ©venot, aby evropÅ¡tÃ­ farmÃ¡Å™i Äelili nefÃ©rovÃ© konkurenci dovozu ze zemÃ­ s niÅ¾Å¡Ã­mi ekologickÃ½mi standardy?
                <div style="margin-top: 6px;">
                  <label><input type="radio" name="prov_q2" value="A"> ZvÃ½Å¡enÃ­ dotacÃ­ pro evropskÃ© farmÃ¡Å™e, aby mohli konkurovat niÅ¾Å¡Ã­mi cenami</label><br>
                  <label><input type="radio" name="prov_q2" value="B"> ZÃ¡kaz dovozu, kterÃ½ nesplÅˆuje evropskÃ© standardy, a stanovenÃ­ minimÃ¡lnÃ­ch cen</label><br>
                  <label><input type="radio" name="prov_q2" value="C"> SnÃ­Å¾enÃ­ evropskÃ½ch ekologickÃ½ch standardÅ¯ na ÃºroveÅˆ mezinÃ¡rodnÃ­ch konkurentÅ¯</label>
                </div>
              </li>
              <li style="margin-bottom: 12px;">
                JakÃ½ je podle Jeana Matthieu ThÃ©venota fundamentÃ¡lnÃ­ princip, kterÃ½ by mÄ›l platit pro potraviny v rÃ¡mci mezinÃ¡rodnÃ­ho obchodu?
                <div style="margin-top: 6px;">
                  <label><input type="radio" name="prov_q3" value="A"> Potraviny by mÄ›ly bÃ½t co nejlevnÄ›jÅ¡Ã­, aby byly dostupnÃ© pro vÅ¡echny, bez ohledu na vÃ½robnÃ­ nÃ¡klady</label><br>
                  <label><input type="radio" name="prov_q3" value="B"> Ceny potravin by mÄ›ly bÃ½t urÄovÃ¡ny vÃ½hradnÄ› poptÃ¡vkou velkÃ½ch supermarketovÃ½ch Å™etÄ›zcÅ¯</label><br>
                  <label><input type="radio" name="prov_q3" value="C"> HlavnÃ­m cÃ­lem kaÅ¾dÃ©ho farmÃ¡Å™e by mÄ›l bÃ½t primÃ¡rnÄ› export na globÃ¡lnÃ­ trh</label><br>
                  <label><input type="radio" name="prov_q3" value="D"> Potraviny by nemÄ›ly bÃ½t povaÅ¾ovÃ¡ny za bÄ›Å¾nou komoditu a nemÄ›ly by bÃ½t souÄÃ¡stÃ­ dohod o volnÃ©m obchodu</label>
                </div>
              </li>
            </ol>

            <div id="provenceQuizResult" style="margin-top: 10px;"></div>

            <button class="button" onclick="evaluateProvenceQuiz()">
              Vyhodnotit kvÃ­z
            </button>
          </div>
        `;
      }

      if (minigame.type === 'greenwashing_quiz') {
        return `
          <div class="minigame-container">
            <h3>ğŸ® Minihra: Greenwashing â€“ slib, nebo skuteÄnÃ¡ zmÄ›na?</h3>
            <p style="font-size: 14px; margin: 10px 0;">
              U kaÅ¾dÃ©ho tvrzenÃ­ vyber, zda jde spÃ­Å¡ o <strong>skuteÄnÃ½ zÃ¡vazek</strong>, nebo o <strong>greenwashing / planÃ½ slib</strong>.
            </p>

            <div style="font-size: 14px; line-height: 1.7;">
              <p><strong>1.</strong> â€Do roku 2050 budeme <em>net-zero</em>. NepotÅ™ebujeme teÄ sniÅ¾ovat tÄ›Å¾bu ropy, budeme investovat do offsetÅ¯ a inovacÃ­.â€œ<br>
                <label><input type="radio" name="gw_q1" value="real"> SkuteÄnÃ½ zÃ¡vazek</label>
                <label style="margin-left: 10px;"><input type="radio" name="gw_q1" value="wash"> Greenwashing / planÃ½ slib</label>
              </p>
              <p><strong>2.</strong> â€Od pÅ™Ã­Å¡tÃ­ho roku zveÅ™ejnÃ­me kompletnÃ­ emise <em>Scope 1, 2 i 3</em> a jasnÃ½ plÃ¡n, jak je do roku 2030 snÃ­Å¾it o 50 %.â€œ<br>
                <label><input type="radio" name="gw_q2" value="real"> SkuteÄnÃ½ zÃ¡vazek</label>
                <label style="margin-left: 10px;"><input type="radio" name="gw_q2" value="wash"> Greenwashing / planÃ½ slib</label>
              </p>
              <p><strong>3.</strong> â€Jsme <em>uhlÃ­kovÄ› neutrÃ¡lnÃ­</em>, protoÅ¾e kupujeme levnÃ© offsety na vÃ½sadbu stromÅ¯, zatÃ­mco otevÃ­rÃ¡me novÃ© ropnÃ© vrty.â€œ<br>
                <label><input type="radio" name="gw_q3" value="real"> SkuteÄnÃ½ zÃ¡vazek</label>
                <label style="margin-left: 10px;"><input type="radio" name="gw_q3" value="wash"> Greenwashing / planÃ½ slib</label>
              </p>
              <p><strong>4.</strong> â€ZavÃ­rÃ¡me uhelnou elektrÃ¡rnu o 10 let dÅ™Ã­ve a nahrazujeme ji obnovitelnÃ½mi zdroji. Detaily projektu jsou veÅ™ejnÃ© a kontrolovanÃ© nezÃ¡vislÃ½mi experty.â€œ<br>
                <label><input type="radio" name="gw_q4" value="real"> SkuteÄnÃ½ zÃ¡vazek</label>
                <label style="margin-left: 10px;"><input type="radio" name="gw_q4" value="wash"> Greenwashing / planÃ½ slib</label>
              </p>
            </div>

            <div id="greenwashResult" style="margin-top: 10px;"></div>

            <button class="button" onclick="evaluateGreenwashingQuiz()">
              Vyhodnotit greenwashing
            </button>
          </div>
        `;
      }
      
      if (minigame.type === 'simple_quiz') {
        return `
          <div class="minigame-container">
            <h3>ğŸ® Minihra: Zamysli se nad pÅ™Ã­bÄ›hem</h3>
            <p style="font-size: 14px; margin: 10px 0;">
              PÅ™eÄti si pÅ™Ã­bÄ›h a zkus si odpovÄ›dÄ›t: Kdo mÄ›l moc rozhodnout? Co Å¡lo udÄ›lat jinak? Koho se to tÃ½kalo nejvÃ­c?
            </p>
            <p style="font-size: 13px; opacity: 0.8;">
              (Tady mÅ¯Å¾eÅ¡ pozdÄ›ji doplnit konkrÃ©tnÃ­ kvÃ­zovÃ© otÃ¡zky pro kaÅ¾dÃ½ fragment.)
            </p>
          </div>
        `;
      }

      return '';
    }

    // SYSTEM CHANGE LOGIKA
    function initSystemChange() {
      const fragment = FRAGMENTS.find(f => f.id === currentFragment.id);
      if (!fragment || !fragment.minigame || fragment.minigame.type !== 'system_change') return;

      const mg = fragment.minigame;
      systemState = {
        round: 1,
        year: mg.startYear,
        budget: mg.budget,
        systems: JSON.parse(JSON.stringify(mg.systems)),
        selectedPolicies: [],
        appliedPolicies: [],
        availablePolicies: mg.policies.filter(p => !p.unlock),
        gameOver: false
      };

      updateSystemDashboard();
      renderSystemPolicies();
      updateSystemInfo();
    }

    function updateSystemDashboard() {
      if (!systemState) return;
      
      const dashboard = document.getElementById('systemDashboard');
      if (!dashboard) return;

      dashboard.innerHTML = Object.entries(systemState.systems).map(([key, system]) => {
        const metrics = system.metrics;
        const targets = system.targets;
        
        let criticalCount = 0;
        let excellentCount = 0;
        
        Object.entries(targets).forEach(([metric, target]) => {
          const value = metrics[metric];
          const [op, threshold] = [target.includes('â‰¥') ? 'â‰¥' : 'â‰¤', parseFloat(target.replace(/[â‰¥â‰¤]/g, ''))];
          
          if (op === 'â‰¥' && value < threshold) criticalCount++;
          if (op === 'â‰¤' && value > threshold) criticalCount++;
          if (op === 'â‰¥' && value >= threshold) excellentCount++;
          if (op === 'â‰¤' && value <= threshold) excellentCount++;
        });

        const cardClass = criticalCount > 0 ? 'critical' : excellentCount === Object.keys(targets).length ? 'excellent' : '';

        return `
          <div class="system-card ${cardClass}">
            <div class="system-header">
              <span>${system.name}</span>
            </div>
            ${Object.entries(metrics).map(([metric, value]) => {
              const target = targets[metric];
              let status = 'neutral';
              if (target) {
                const [op, threshold] = [target.includes('â‰¥') ? 'â‰¥' : 'â‰¤', parseFloat(target.replace(/[â‰¥â‰¤]/g, ''))];
                if (op === 'â‰¥') status = value >= threshold ? 'good' : 'bad';
                if (op === 'â‰¤') status = value <= threshold ? 'good' : 'bad';
              }
              return `
                <div class="metric-row">
                  <span>${getMetricLabel(metric)}:</span>
                  <span class="metric-value ${status}">${formatMetricValue(metric, value)} ${target ? `(cÃ­l: ${target})` : ''}</span>
                </div>
              `;
            }).join('')}
          </div>
        `;
      }).join('');
    }

    function getMetricLabel(metric) {
      const labels = {
        gdp: 'HDP', unemployment: 'NezamÄ›st.', growth: 'RÅ¯st',
        emissions: 'Emise', temperature: 'Teplota', disasters: 'Katastrofy',
        inequality: 'Nerovnost', happiness: 'Spokojenost', education: 'VzdÄ›lÃ¡nÃ­',
        renewable: 'ObnovitelnÃ©', stability: 'Stabilita', cost: 'NÃ¡klady',
        production: 'Produkce', price: 'Cena', security: 'BezpeÄnost',
        biodiversity: 'Biodiverzita', health: 'ZdravÃ­', protected: 'ChrÃ¡nÄ›no'
      };
      return labels[metric] || metric;
    }

    function formatMetricValue(metric, value) {
      if (metric === 'temperature') return `${value.toFixed(1)}Â°C`;
      if (['renewable', 'emissions', 'inequality', 'happiness', 'education', 'stability', 'protected'].includes(metric)) {
        return `${Math.round(value)}%`;
      }
      if (metric === 'growth') return `${value.toFixed(1)}%`;
      return Math.round(value);
    }

    function renderSystemPolicies() {
      if (!systemState) return;
      
      const grid = document.getElementById('systemPoliciesGrid');
      if (!grid) return;

      const fragment = FRAGMENTS.find(f => f.id === currentFragment.id);
      const allPolicies = fragment.minigame.policies;

      let displayPolicies = systemState.availablePolicies;
      if (currentFilter !== 'all') {
        displayPolicies = displayPolicies.filter(p => p.category === currentFilter);
      }

      grid.innerHTML = displayPolicies.map(policy => {
        const isSelected = systemState.selectedPolicies.includes(policy.id);
        const isApplied = systemState.appliedPolicies.includes(policy.id);
        const hasSynergy = systemState.selectedPolicies.some(selectedId => {
          const selectedPolicy = allPolicies.find(p => p.id === selectedId);
          return selectedPolicy?.synergy?.includes(policy.id) || policy.synergy?.includes(selectedId);
        });
        const hasConflict = systemState.selectedPolicies.some(selectedId => {
          const selectedPolicy = allPolicies.find(p => p.id === selectedId);
          return selectedPolicy?.conflict?.includes(policy.id);
        });

        const classes = ['policy-card'];
        if (isSelected) classes.push('selected');
        if (isApplied) classes.push('disabled');
        if (hasConflict) classes.push('disabled');
        if (hasSynergy && !isSelected) classes.push('synergy-highlight');

        return `
          <div class="${classes.join(' ')}" onclick="toggleSystemPolicy(${policy.id})" data-policy-id="${policy.id}">
            <div class="policy-header">
              <div class="policy-icon">${policy.icon}</div>
              <div class="policy-name">${policy.name}</div>
            </div>
            <div class="policy-desc">${policy.desc}</div>
            <div class="policy-effects">
              <span class="effect-badge ${policy.cost > 0 ? 'positive' : policy.cost < 0 ? 'negative' : 'neutral'}">
                ${policy.cost > 0 ? '+' : ''}${policy.cost} mld â‚¬
              </span>
              ${renderPolicyEffects(policy.effects)}
            </div>
            ${isApplied ? '<div style="margin-top: 8px; color: #666; font-size: 11px;">âœ“ JiÅ¾ aktivnÃ­</div>' : ''}
          </div>
        `;
      }).join('');
    }

    function renderPolicyEffects(effects) {
      let badges = [];
      Object.entries(effects).forEach(([system, changes]) => {
        Object.entries(changes).forEach(([metric, value]) => {
          if (value !== 0) {
            const isPositive = (metric === 'emissions' || metric === 'inequality' || metric === 'unemployment' || metric === 'disasters' || metric === 'price' || metric === 'cost') ? value < 0 : value > 0;
            badges.push(`
              <span class="effect-badge ${isPositive ? 'positive' : 'negative'}">
                ${value > 0 ? '+' : ''}${formatMetricValue(metric, value)} ${getMetricLabel(metric)}
              </span>
            `);
          }
        });
      });
      return badges.join('');
    }

    window.toggleSystemPolicy = function(policyId) {
      if (!systemState || systemState.gameOver) return;

      const fragment = FRAGMENTS.find(f => f.id === currentFragment.id);
      const allPolicies = fragment.minigame.policies;
      const policy = allPolicies.find(p => p.id === policyId);

      if (systemState.appliedPolicies.includes(policyId)) return;

      const hasConflict = systemState.selectedPolicies.some(selectedId => {
        const selectedPolicy = allPolicies.find(p => p.id === selectedId);
        return selectedPolicy?.conflict?.includes(policyId);
      });

      if (hasConflict) return;

      const index = systemState.selectedPolicies.indexOf(policyId);
      if (index > -1) {
        systemState.selectedPolicies.splice(index, 1);
      } else {
        systemState.selectedPolicies.push(policyId);
      }

      renderSystemPolicies();
    };

    window.filterPolicies = function(category) {
      currentFilter = category;
      
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.cat === category) {
          btn.classList.add('active');
        }
      });

      renderSystemPolicies();
    };

    window.advanceSystemRound = function() {
      if (!systemState || systemState.gameOver) return;

      const fragment = FRAGMENTS.find(f => f.id === currentFragment.id);
      const allPolicies = fragment.minigame.policies;

      let totalCost = 0;
      systemState.selectedPolicies.forEach(policyId => {
        const policy = allPolicies.find(p => p.id === policyId);
        totalCost += policy.cost;
      });

      if (systemState.budget + totalCost < 0) {
        showSystemMessage("ğŸ’¸ ROZPOÄŒET NENÃ DOSTATEÄŒNÃ! Vyberte levnÄ›jÅ¡Ã­ politiky.", "error");
        return;
      }

      systemState.budget += totalCost;

      systemState.selectedPolicies.forEach(policyId => {
        const policy = allPolicies.find(p => p.id === policyId);
        applyPolicyEffects(policy);
        systemState.appliedPolicies.push(policyId);
      });

      systemState.selectedPolicies = [];

      const crisis = fragment.minigame.crises.find(c => c.round === systemState.round);
      if (crisis) {
        showCrisis(crisis);
        applyCrisisEffects(crisis);
      }

      systemState.round++;
      systemState.year += 5;

      allPolicies.forEach(policy => {
        if (policy.unlock && systemState.round >= policy.unlock) {
          if (!systemState.availablePolicies.find(p => p.id === policy.id) && !systemState.appliedPolicies.includes(policy.id)) {
            systemState.availablePolicies.push(policy);
          }
        }
      });

      updateSystemDashboard();
      renderSystemPolicies();
      updateSystemInfo();

      if (systemState.round > 5) {
        checkVictory(fragment.minigame);
      }
    };

    function applyPolicyEffects(policy) {
      Object.entries(policy.effects).forEach(([systemKey, changes]) => {
        if (systemState.systems[systemKey]) {
          Object.entries(changes).forEach(([metric, value]) => {
            systemState.systems[systemKey].metrics[metric] += value;
          });
        }
      });
    }

    function applyCrisisEffects(crisis) {
      Object.entries(crisis.effects).forEach(([systemKey, changes]) => {
        if (systemState.systems[systemKey]) {
          Object.entries(changes).forEach(([metric, value]) => {
            systemState.systems[systemKey].metrics[metric] += value;
          });
        }
      });
    }

    function showCrisis(crisis) {
      const container = document.getElementById('crisisContainer');
      if (!container) return;

      container.innerHTML = `
        <div class="crisis-modal">
          <h3 style="margin: 0 0 15px 0;">${crisis.name}</h3>
          <p style="font-size: 14px;">${crisis.desc}</p>
          <p style="font-size: 13px; margin-top: 10px; opacity: 0.9;">Dopady byly automaticky aplikovÃ¡ny.</p>
        </div>
      `;

      setTimeout(() => {
        container.innerHTML = '';
      }, 4000);
    }

    function checkVictory(minigame) {
      let achievedTargets = 0;
      let totalTargets = 0;

      Object.entries(systemState.systems).forEach(([key, system]) => {
        Object.entries(system.targets).forEach(([metric, target]) => {
          totalTargets++;
          const value = system.metrics[metric];
          const [op, threshold] = [target.includes('â‰¥') ? 'â‰¥' : 'â‰¤', parseFloat(target.replace(/[â‰¥â‰¤]/g, ''))];
          
          if ((op === 'â‰¥' && value >= threshold) || (op === 'â‰¤' && value <= threshold)) {
            achievedTargets++;
          }
        });
      });

      const percentage = (achievedTargets / totalTargets) * 100;

      const resultContainer = document.getElementById('systemResult');
      if (!resultContainer) return;

      if (percentage >= 90) {
        resultContainer.innerHTML = `
          <div class="victory-box">
            <h2 style="color: #00ff88; margin: 0 0 15px 0;">âœ… SYSTÃ‰MOVÃ TRANSFORMACE ÃšSPÄšÅ NÃ!</h2>
            <p style="font-size: 18px;">DosaÅ¾eno ${achievedTargets}/${totalTargets} cÃ­lÅ¯ (${percentage.toFixed(0)} %)</p>
            <div style="margin-top: 20px; padding: 20px; background: rgba(0,255,136,0.2); border-radius: 8px;">
              <strong>Dopad na rok 2100:</strong><br>
              âœ… SystÃ©movÃ¡ zmÄ›na probÄ›hla ÃºspÄ›Å¡nÄ›<br>
              âœ… Klima stabilizovÃ¡no, spoleÄnost spravedlivÃ¡<br>
              âœ… Ekonomika udrÅ¾itelnÃ¡, ekosystÃ©my zdravÃ©<br>
              âœ… Civilizace zachrÃ¡nÄ›na
            </div>
          </div>
        `;
      } else if (percentage >= 70) {
        resultContainer.innerHTML = `
          <div style="background: linear-gradient(135deg, rgba(255,165,0,0.3), rgba(255,200,0,0.3)); border: 3px solid #ffa500; border-radius: 12px; padding: 30px; margin: 20px 0; text-align: center;">
            <h2 style="color: #ffa500; margin: 0 0 15px 0;">âš ï¸ ÄŒÃSTEÄŒNÃ ÃšSPÄšCH</h2>
            <p style="font-size: 18px;">DosaÅ¾eno ${achievedTargets}/${totalTargets} cÃ­lÅ¯ (${percentage.toFixed(0)} %)</p>
            <div style="margin-top: 20px; padding: 20px; background: rgba(255,165,0,0.2); border-radius: 8px;">
              <strong>Dopad na rok 2100:</strong><br>
              ğŸ”¥ NÄ›kterÃ© systÃ©my stabilizovÃ¡ny, jinÃ© ne<br>
              âš ï¸ StÅ™ednÄ› zÃ¡vaÅ¾nÃ© problÃ©my pÅ™etrvÃ¡vajÃ­<br>
              ğŸ’° VysokÃ© nÃ¡klady na adaptaci
            </div>
          </div>
        `;
      } else {
        resultContainer.innerHTML = `
          <div class="game-over-box">
            <h2 style="color: #ff4444; margin: 0 0 15px 0;">ğŸ’€ SYSTÃ‰MOVÃ KOLAPS</h2>
            <p style="font-size: 18px;">DosaÅ¾eno pouze ${achievedTargets}/${totalTargets} cÃ­lÅ¯ (${percentage.toFixed(0)} %)</p>
            <div style="margin-top: 20px; padding: 20px; background: rgba(255,68,68,0.2); border-radius: 8px;">
              <strong>Dopad na rok 2100:</strong><br>
              ğŸ”¥ SystÃ©my selhaly napÅ™Ã­Ä celou civilizacÃ­<br>
              ğŸ’€ KaskÃ¡dovÃ½ kolaps spoleÄnosti<br>
              ğŸŒ Planeta neobyvatelnÃ¡
            </div>
          </div>
        `;
      }

      systemState.gameOver = true;
      const btn = document.getElementById('systemAdvanceBtn');
      if (btn) btn.disabled = true;
    }

    function updateSystemInfo() {
      const info = document.getElementById('systemRoundInfo');
      if (info && systemState) {
        info.textContent = `ğŸ“… ROK ${systemState.year} | KOLO ${systemState.round}/5 | RozpoÄet: ${Math.round(systemState.budget)} mld â‚¬`;
      }
    }

    function showSystemMessage(msg, type) {
      const container = document.getElementById('crisisContainer');
      if (!container) return;

      const color = type === 'error' ? '#ff4444' : '#00ff88';
      container.innerHTML = `
        <div style="background: rgba(255,68,68,0.2); border: 2px solid ${color}; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center;">
          <p style="font-size: 16px; margin: 0;">${msg}</p>
        </div>
      `;

      setTimeout(() => {
        container.innerHTML = '';
      }, 3000);
    }

    // === MINIHRY MIMO FRAGMENTY ===

    // 1) FACT-CHECKER 2125
    window.openFactChecker = function() {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <h2>ğŸ§  Fact-checker 2125</h2>
          <p style="font-size: 15px; line-height: 1.7; margin-bottom: 20px;">
            V roce 2025 proudily sÃ­tÄ›mi tisÃ­ce vÃ½rokÅ¯ o klimatu. TvÃ½m Ãºkolem je oznaÄit, zda jde o
            <strong>vÄ›decky podloÅ¾enÃ½ vÃ½rok</strong> (PRAVDA), nebo o <strong>dezinformaci / manipulaci</strong>.
          </p>
          ${FACT_CHECK_QUESTIONS.map((q, idx) => `
            <div style="margin-bottom: 18px; padding: 12px; background: rgba(0,0,0,0.4); border-radius: 8px; border: 1px solid rgba(0,255,136,0.2);">
              <div style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">
                ${idx + 1}. ${q.statement}
              </div>
              <div style="display:flex; gap:15px; flex-wrap:wrap; font-size: 14px;">
                <label>
                  <input type="radio" name="fc_q${q.id}" value="truth" style="margin-right:6px;">
                  PRAVDA (v souladu s vÄ›deckÃ½m konsenzem)
                </label>
                <label>
                  <input type="radio" name="fc_q${q.id}" value="misinfo" style="margin-right:6px;">
                  DEZINFORMACE / MANIPULACE
                </label>
              </div>
            </div>
          `).join('')}
          <div id="factCheckerResult" style="margin-top: 20px;"></div>
          <div style="margin-top: 10px;">
            <button class="button" onclick="evaluateFactChecker()">Vyhodnotit kvÃ­z</button>
            <button class="button button-secondary" onclick="closeModal()">ZavÅ™Ã­t</button>
          </div>
        </div>
      `;
      document.getElementById('modalContainer').appendChild(modal);
    };

    window.evaluateFactChecker = function() {
      let correct = 0;
      let total = FACT_CHECK_QUESTIONS.length;
      let answered = 0;
      let details = '';

      FACT_CHECK_QUESTIONS.forEach(q => {
        const selected = document.querySelector(`input[name="fc_q${q.id}"]:checked`);
        if (selected) {
          answered++;
          const isCorrect = selected.value === q.correct;
          if (isCorrect) correct++;
          details += `
            <div style="margin-bottom: 12px; font-size: 14px;">
              <strong>${isCorrect ? 'âœ… SprÃ¡vnÄ›:' : 'âŒ NesprÃ¡vnÄ›:'}</strong>
              <span> ${q.statement}</span>
              <br>
              <span style="opacity:0.9;">${q.explanation}</span>
            </div>
          `;
        } else {
          details += `
            <div style="margin-bottom: 12px; font-size: 14px;">
              <strong>âš ï¸ NezodpovÄ›zeno:</strong> ${q.statement}
            </div>
          `;
        }
      });

      const resultDiv = document.getElementById('factCheckerResult');
      if (!resultDiv) return;

      let scoreColor = '#ffa500';
      if (correct / total >= 0.75) scoreColor = '#00ff88';
      if (correct / total <= 0.4) scoreColor = '#ff4444';

      resultDiv.innerHTML = `
        <div style="background: rgba(0,0,0,0.5); border-radius: 8px; padding: 16px; border: 1px solid rgba(0,255,136,0.3);">
          <p style="font-size: 15px; margin-bottom: 10px;">
            OdpovÄ›dÄ›li jste na ${answered}/${total} vÃ½rokÅ¯. 
            <strong style="color:${scoreColor};">SprÃ¡vnÄ›: ${correct}/${total}</strong>
          </p>
          <div style="max-height: 260px; overflow-y:auto; padding-right:6px;">
            ${details}
          </div>
          <p style="font-size: 13px; opacity: 0.8; margin-top: 10px;">
            ğŸ§© V roce 2125 jsou mediÃ¡lnÃ­ gramotnost a fact-checking jednou z klÃ­ÄovÃ½ch dovednostÃ­ pÅ™eÅ¾ivÅ¡Ã­ch.
          </p>
        </div>
      `;
    };

    // 2) KALKULAÄŒKA OSOBNÃ UHLÃKOVÃ‰ STOPY
    window.openCarbonCalculator = function() {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <h2>ğŸŒ¿ KalkulaÄka osobnÃ­ uhlÃ­kovÃ© stopy</h2>
          <p style="font-size: 15px; line-height: 1.7; margin-bottom: 20px;">
            Tohle je <strong>zjednoduÅ¡enÃ½ odhad</strong>, kterÃ½ ukazuje, kde majÃ­ jednotlivÃ© volby nejvÄ›tÅ¡Ã­ dopad.
            NeslouÅ¾Ã­ jako pÅ™esnÃ½ vÄ›deckÃ½ nÃ¡stroj, ale jako pomÅ¯cka k zamyÅ¡lenÃ­.
          </p>
          <div class="cf-grid">
            <div class="cf-question">
              <label>âœˆï¸ LeteckÃ¡ doprava</label>
              <select id="cf_flights">
                <option value="0">NelÃ©tÃ¡m / jednou za mnoho let</option>
                <option value="1.5">1 krÃ¡tkÃ½ let roÄnÄ› (Evropa)</option>
                <option value="3">2â€“3 lety roÄnÄ› (mix Evropa / dÃ¡lka)</option>
                <option value="5">ÄŒasto lÃ©tÃ¡m (4+ letÅ¯ roÄnÄ›)</option>
              </select>
              <div class="cf-note">Lety patÅ™Ã­ mezi nejvÄ›tÅ¡Ã­ osobnÃ­ zdroje emisÃ­.</div>
            </div>
            <div class="cf-question">
              <label>ğŸš— Auto a doprava</label>
              <select id="cf_car">
                <option value="0.3">NemÃ¡m auto, jezdÃ­m hlavnÄ› pÄ›Å¡ky/MHD</option>
                <option value="1.5">Auto jen obÄas (do 5 000 km/rok)</option>
                <option value="3">Auto Äasto (5â€“15 000 km/rok)</option>
                <option value="5">Auto dennÄ› (15 000+ km/rok, spalovÃ¡k)</option>
              </select>
              <div class="cf-note">RozdÃ­l mezi spalovÃ¡kem a hromadnou dopravou je obrovskÃ½.</div>
            </div>
            <div class="cf-question">
              <label>ğŸ½ï¸ Strava</label>
              <select id="cf_food">
                <option value="1">PÅ™evÃ¡Å¾nÄ› rostlinnÃ¡ strava</option>
                <option value="1.8">VegetariÃ¡n/ka</option>
                <option value="2.5">Maso cca 1Ã— dennÄ›</option>
                <option value="3.5">Maso vÃ­ckrÃ¡t dennÄ›</option>
              </select>
              <div class="cf-note">MÃ©nÄ› masa = niÅ¾Å¡Ã­ emise, hlavnÄ› u hovÄ›zÃ­ho.</div>
            </div>
            <div class="cf-question">
              <label>ğŸ  BydlenÃ­ a vytÃ¡pÄ›nÃ­</label>
              <select id="cf_home">
                <option value="1">Byt v zateplenÃ©m domÄ›, OZE / tepelnÃ© Äerpadlo</option>
                <option value="2">Byt, plyn / centrÃ¡lnÃ­ topenÃ­</option>
                <option value="3">RodinnÃ½ dÅ¯m, plyn</option>
                <option value="4">RodinnÃ½ dÅ¯m, uhlÃ­ / starÃ½ kotel</option>
              </select>
              <div class="cf-note">EnergetickÃ¡ nÃ¡roÄnost budov a zdroj tepla jsou zÃ¡sadnÃ­.</div>
            </div>
            <div class="cf-question">
              <label>ğŸ›’ SpotÅ™eba vÄ›cÃ­</label>
              <select id="cf_goods">
                <option value="0.8">Minimalista â€“ mÃ¡lo nÃ¡kupÅ¯, opravuji / second hand</option>
                <option value="1.5">PrÅ¯mÄ›rnÃ¡ spotÅ™eba</option>
                <option value="3">HodnÄ› nakupuji (elektronika, mÃ³da, gadgety)</option>
              </select>
              <div class="cf-note">KaÅ¾dÃ½ novÃ½ produkt mÃ¡ emise z vÃ½roby a dopravy.</div>
            </div>
          </div>
          <div id="carbonResult" style="margin-top: 20px;"></div>
          <div style="margin-top: 10px;">
            <button class="button" onclick="calculateCarbonFootprint()">SpoÄÃ­tat</button>
            <button class="button button-secondary" onclick="closeModal()">ZavÅ™Ã­t</button>
          </div>
        </div>
      `;
      document.getElementById('modalContainer').appendChild(modal);
    };

    window.calculateCarbonFootprint = function() {
      function val(id) {
        const el = document.getElementById(id);
        return el ? parseFloat(el.value || '0') : 0;
      }

      const flights = val('cf_flights');
      const car = val('cf_car');
      const food = val('cf_food');
      const home = val('cf_home');
      const goods = val('cf_goods');

      const total = +(flights + car + food + home + goods).toFixed(1);

      let level = '';
      let msg = '';
      if (total < 3) {
        level = 'niÅ¾Å¡Ã­ neÅ¾ prÅ¯mÄ›r';
        msg = 'Tvoje uhlÃ­kovÃ¡ stopa je relativnÄ› nÃ­zkÃ¡. I tak mÃ¡ smysl zamÄ›Å™it se na velkÃ© poloÅ¾ky (lety, auto) a svÅ¯j pÅ™Ã­klad vyuÅ¾Ã­t k inspiraci ostatnÃ­ch.';
      } else if (total < 7) {
        level = 'v blÃ­zkosti prÅ¯mÄ›ru v EU';
        msg = 'Jsi nÄ›kde kolem dneÅ¡nÃ­ho evropskÃ©ho prÅ¯mÄ›ru. NejvÄ›tÅ¡Ã­ potenciÃ¡l ke snÃ­Å¾enÃ­ bÃ½vÃ¡ u dopravy (auto, lety) a u bydlenÃ­ (zateplenÃ­, zdroj tepla).';
      } else {
        level = 'vÃ½raznÄ› nad prÅ¯mÄ›rem';
        msg = 'Tvoje stopa je vÃ½raznÄ› vyÅ¡Å¡Ã­. Pokud by takhle Å¾il kaÅ¾dÃ½, potÅ™ebovali bychom nÄ›kolik planet. NejvÄ›tÅ¡Ã­ efekt pÅ™inese mÃ©nÄ› lÃ©tÃ¡nÃ­, zmÄ›ny v dopravÄ› a v bydlenÃ­.';
      }

      const resultDiv = document.getElementById('carbonResult');
      if (!resultDiv) return;

      resultDiv.innerHTML = `
        <div style="background: rgba(0,0,0,0.5); border-radius: 8px; padding: 16px; border: 1px solid rgba(0,255,136,0.3);">
          <p style="font-size: 16px; margin-bottom: 8px;">
            TvÅ¯j hrubÃ½ odhad osobnÃ­ uhlÃ­kovÃ© stopy je
            <strong>${total} t COâ‚‚e / rok</strong>.
          </p>
          <p style="font-size: 15px; margin-bottom: 10px;">
            To je <strong>${level}</strong>.
          </p>
          <ul style="font-size: 14px; line-height: 1.6; margin-bottom: 10px;">
            <li>âœˆï¸ LeteckÃ¡ doprava: ~${flights} t</li>
            <li>ğŸš— Doprava autem: ~${car} t</li>
            <li>ğŸ½ï¸ Strava: ~${food} t</li>
            <li>ğŸ  BydlenÃ­: ~${home} t</li>
            <li>ğŸ›’ SpotÅ™eba vÄ›cÃ­: ~${goods} t</li>
          </ul>
          <p style="font-size: 14px; margin-top: 10px;">
            ${msg}
          </p>
          <p style="font-size: 12px; opacity: 0.75; margin-top: 8px;">
            ğŸ“Œ PoznÃ¡mka: Jde o hrubÃ½ model pro edukaci, skuteÄnÃ© hodnoty zÃ¡visÃ­ na mnoha detailech (konkrÃ©tnÃ­ typy aut, letÅ¯, domu, energetickÃ©ho mixu atd.).
          </p>
        </div>
      `;
    };

    // Provence quiz vyhodnocenÃ­
    window.evaluateProvenceQuiz = function() {
      const answers = {
        prov_q1: 'C',
        prov_q2: 'B',
        prov_q3: 'D'
      };
      let correct = 0;
      let total = 3;
      let answered = 0;

      Object.keys(answers).forEach(key => {
        const selected = document.querySelector(`input[name="${key}"]:checked`);
        if (selected) {
          answered++;
          if (selected.value === answers[key]) correct++;
        }
      });

      const resultDiv = document.getElementById('provenceQuizResult');
      if (!resultDiv) return;

      if (answered < total) {
        resultDiv.innerHTML = `
          <p style="color:#ffa500; font-size:14px; margin-top:8px;">
            âš ï¸ NeodpovÄ›dÄ›l/a jsi na vÅ¡echny otÃ¡zky (${answered}/${total}). Zkus to doplnit.
          </p>
        `;
        return;
      }

      const ok = correct === total;
      resultDiv.innerHTML = `
        <p style="font-size:14px; margin-top:8px; color:${ok ? '#00ff88' : '#ffa500'};">
          ${ok 
            ? 'âœ… VÃ½bornÄ›! VÅ¡echny odpovÄ›di mÃ¡Å¡ sprÃ¡vnÄ› â€“ dobÅ™e rozumÃ­Å¡ tomu, co Jean Matthieu ThÃ©venot Å™Ã­kÃ¡ o agroprÅ¯myslu a pravidlech obchodu s potravinami.' 
            : `â„¹ï¸ SprÃ¡vnÃ½ch odpovÄ›dÃ­: ${correct}/${total}. Zkus se k zÃ¡znamu jeÅ¡tÄ› vrÃ¡tit a zamyslet se nad tÃ­m, kdo mÃ¡ v systÃ©mu nejvÄ›tÅ¡Ã­ sÃ­lu a jak ji pouÅ¾Ã­vÃ¡.`}
        </p>
      `;
    };

    // Greenwashing minihra vyhodnocenÃ­
    window.evaluateGreenwashingQuiz = function() {
      const correctMap = {
        gw_q1: 'wash',
        gw_q2: 'real',
        gw_q3: 'wash',
        gw_q4: 'real'
      };
      let correct = 0;
      let total = 4;
      let answered = 0;

      Object.keys(correctMap).forEach(key => {
        const selected = document.querySelector(`input[name="${key}"]:checked`);
        if (selected) {
          answered++;
          if (selected.value === correctMap[key]) correct++;
        }
      });

      const resultDiv = document.getElementById('greenwashResult');
      if (!resultDiv) return;

      if (answered < total) {
        resultDiv.innerHTML = `
          <p style="color:#ffa500; font-size:14px; margin-top:8px;">
            âš ï¸ NeodpovÄ›dÄ›l/a jsi na vÅ¡echna tvrzenÃ­ (${answered}/${total}). Zkus nejdÅ™Ã­v doplnit zbytek.
          </p>
        `;
        return;
      }

      let msg = '';
      if (correct === total) {
        msg = "âœ… PerfektnÃ­! UmÃ­Å¡ dobÅ™e rozliÅ¡it mezi marketingem a skuteÄnou zmÄ›nou. V reÃ¡lnÃ©m svÄ›tÄ› je tohle skill na Ãºrovni superhrdiny.";
      } else if (correct >= 2) {
        msg = `â„¹ï¸ MÃ¡Å¡ ${correct}/${total} sprÃ¡vnÄ›. ÄŒÃ¡st greenwashingu jsi rozpoznÄ›l/a, ale nÄ›kterÃ© triky jsou fakt rafinovanÃ© â€“ vÅ¾dy hledej konkrÃ©tnÃ­ Äiny, ne jen hezkÃ¡ slova.`;
      } else {
        msg = `âŒ Pouze ${correct}/${total} sprÃ¡vnÄ›. Ukazuje to, jak snadno se dÃ¡ na greenwashing naletÄ›t â€“ proto firmy tak rÃ¡dy pouÅ¾Ã­vajÃ­ vÃ¡gnÃ­ sliby typu â€do roku 2050â€œ bez detailÅ¯.`;
      }

      resultDiv.innerHTML = `
        <p style="font-size:14px; margin-top:8px; color:${correct === total ? '#00ff88' : (correct >= 2 ? '#ffa500' : '#ff4444')}">
          ${msg}
        </p>
        <p style="font-size:12px; opacity:0.8; margin-top:4px;">
          ğŸ’¡ Tip: SkuteÄnÃ½ zÃ¡vazek mÃ¡ <strong>konkrÃ©tnÃ­ ÄÃ­sla, termÃ­ny, mezicÃ­le, transparentnÃ­ reportovÃ¡nÃ­</strong> a je ovÄ›Å™itelnÃ½ nezÃ¡vislÃ½mi experty. Greenwashing spolÃ©hÃ¡ na vÃ¡gnÃ­ pojmy a posunutÃ­ pozornosti.
        </p>
      `;
    };

    window.collectCurrentFragment = function() {
      if (currentFragment) {
        const fragmentInList = fragments.find(f => f.id === currentFragment.id);
        const fragmentData = FRAGMENTS.find(f => f.id === currentFragment.id);
        
        if (fragmentInList) {
          fragmentInList.collected = true;
          
          const fragmentValue = fragmentData.fragmentValue || 1;
          for (let i = 0; i < fragmentValue; i++) {
            collectedFragments.push(fragmentInList);
          }
          
          updateFragmentCounter();
          
          closeModal();
          
          if (collectedFragments.length >= 14) {
            setTimeout(() => showFinalModal(), 500);
          }
        }
      }
    };

    function showFinalModal() {
      const config = window.elementSdk?.config || defaultConfig;
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <h2>ğŸŒ MISE DOKONÄŒENA</h2>
          <p style="font-size: 18px; line-height: 1.8; margin: 20px 0;">${config.final_message}</p>
          
          <h3 style="margin-top: 30px;">ğŸ“Š Statistiky katastrofy:</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div style="background: rgba(255,68,68,0.2); padding: 20px; border-radius: 8px; border: 2px solid #ff4444;">
              <div style="font-size: 32px; font-weight: bold;">+2.8 Â°C</div>
              <div>GlobÃ¡lnÃ­ oteplenÃ­</div>
            </div>
            <div style="background: rgba(255,68,68,0.2); padding: 20px; border-radius: 8px; border: 2px solid #ff4444;">
              <div style="font-size: 32px; font-weight: bold;">2.1 MLD</div>
              <div>KlimatickÃ½ch uprchlÃ­kÅ¯</div>
            </div>
            <div style="background: rgba(255,68,68,0.2); padding: 20px; border-radius: 8px; border: 2px solid #ff4444;">
              <div style="font-size: 32px; font-weight: bold;">35 %</div>
              <div>VyhynulÃ½ch druhÅ¯</div>
            </div>
            <div style="background: rgba(255,68,68,0.2); padding: 20px; border-radius: 8px; border: 2px solid #ff4444;">
              <div style="font-size: 32px; font-weight: bold;">+1.2 m</div>
              <div>NÃ¡rÅ¯st moÅ™Ã­</div>
            </div>
          </div>

          <h3 style="margin-top: 30px;">â±ï¸ ÄŒasovÃ¡ osa katastrofy:</h3>
          <div style="background: rgba(0,136,255,0.1); padding: 20px; border-radius: 8px; border-left: 4px solid #0088ff; margin: 20px 0;">
            <p><strong>2025â€“2030:</strong> Emise rostly, sliby nedodrÅ¾eny</p>
            <p><strong>2035â€“2045:</strong> PrvnÃ­ tipping pointy pÅ™ekroÄeny</p>
            <p><strong>2050â€“2065:</strong> MasivnÃ­ migrace, prvnÃ­ klimatickÃ© vÃ¡lky</p>
            <p><strong>2070â€“2085:</strong> Kolaps obchodu, zÃ¡plavy mÄ›st, hladomory</p>
            <p><strong>2090â€“2100:</strong> SvÄ›t nepoznatelnÃ½, rozdÄ›lenÃ¡ Evropa</p>
          </div>

          <h3 style="margin-top: 30px;">ğŸ“¢ Co mÅ¯Å¾ete udÄ›lat v roce 2025:</h3>
          <div style="background: rgba(0,255,136,0.1); padding: 20px; border-radius: 8px; border: 2px solid #00ff88; margin: 20px 0; text-align: left;">
            <p>âœ“ Volit sprÃ¡vnÃ© politiky a politiky</p>
            <p>âœ“ PoÅ¾adovat systÃ©movÃ© zmÄ›ny</p>
            <p>âœ“ Podporovat obnovitelnÃ© zdroje</p>
            <p>âœ“ Mluvit o klimatu s ostatnÃ­mi</p>
            <p>âœ“ Å½alovat korporace za Å¡kody</p>
            <p>âœ“ Bojovat za zelenou infrastrukturu</p>
          </div>

          <div style="background: rgba(255,68,68,0.3); padding: 25px; border-radius: 8px; border: 3px solid #ff4444; margin: 30px 0; text-align: center; animation: pulse 2s infinite;">
            <h2 style="color: #ff4444; margin: 0;">ğŸ’€ ZPRÃVA PRO ROK 2025</h2>
            <p style="font-size: 18px; margin-top: 15px;">JeÅ¡tÄ› mÃ¡te Äas. Okno pro akci je stÃ¡le otevÅ™enÃ©.</p>
            <p style="font-size: 20px; font-weight: bold; color: #00ff88;">âš¡ JEDNEJTE TEÄ âš¡</p>
          </div>

          <button class="button" onclick="location.reload()">ğŸ”„ Restartovat misi</button>
        </div>
      `;
      document.getElementById('modalContainer').appendChild(modal);
    }

    window.closeModal = function() {
      const modalContainer = document.getElementById('modalContainer');
      modalContainer.innerHTML = '';
      currentFragment = null;
      systemState = null;
      currentFilter = 'all';
    };

    function updateFragmentCounter() {
      const counter = document.getElementById('fragmentCount');
      counter.textContent = `Fragmenty: ${collectedFragments.length}/${FRAGMENTS.length}`;
    }

    function getNearestFragment() {
      let nearest = null;
      let minDist = Infinity;

      fragments.forEach(fragment => {
        if (fragment.collected) return;
        
        const dx = fragment.x - player.x;
        const dy = fragment.y - player.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        
        if (dist < minDist) {
          minDist = dist;
          nearest = { ...fragment, distance: dist };
        }
      });

      return nearest;
    }

    function update(dt) {
      if (gameState !== 'playing') return;

      const speed = player.speed * dt;

      let moveX = 0;
      let moveY = 0;

      if (keys['w'] || keys['arrowup']) moveY -= speed;
      if (keys['s'] || keys['arrowdown']) moveY += speed;
      if (keys['a'] || keys['arrowleft']) moveX -= speed;
      if (keys['d'] || keys['arrowright']) moveX += speed;

      if (moveX !== 0 && moveY !== 0) {
        moveX *= 0.707;
        moveY *= 0.707;
      }

      player.x += moveX;
      player.y += moveY;

      player.x = Math.max(player.size, Math.min(WORLD_WIDTH - player.size, player.x));
      player.y = Math.max(player.size, Math.min(WORLD_HEIGHT - player.size, player.y));

      camera.x = player.x - canvas.width / 2;
      camera.y = player.y - canvas.height / 2;

      fragments.forEach(f => {
        if (!f.collected) {
          f.pulse += dt * 3;
        }
      });
    }

    function render() {
      if (!ctx || !canvas) return;

      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      gradient.addColorStop(0, '#050510');
      gradient.addColorStop(0.5, '#0f0510');
      gradient.addColorStop(1, '#050f10');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.save();
      ctx.translate(-camera.x, -camera.y);

      ctx.fillStyle = '#2a5a9e';
      ctx.fillRect(0, 0, WORLD_WIDTH, WORLD_HEIGHT);
      
      ctx.fillStyle = '#1a4a2a';
      ctx.strokeStyle = '#2d5a3d';
      ctx.lineWidth = 5;
      
      ctx.beginPath();
      ctx.moveTo(650, 80);
      ctx.lineTo(720, 70);
      ctx.lineTo(780, 90);
      ctx.lineTo(820, 130);
      ctx.lineTo(840, 180);
      ctx.lineTo(860, 240);
      ctx.lineTo(900, 300);
      ctx.lineTo(920, 370);
      ctx.lineTo(930, 440);
      ctx.lineTo(920, 500);
      ctx.lineTo(880, 560);
      ctx.lineTo(840, 610);
      ctx.lineTo(780, 650);
      ctx.lineTo(720, 670);
      ctx.lineTo(660, 680);
      ctx.lineTo(620, 650);
      ctx.lineTo(600, 590);
      ctx.lineTo(550, 560);
      ctx.lineTo(490, 550);
      ctx.lineTo(420, 570);
      ctx.lineTo(360, 580);
      ctx.lineTo(310, 570);
      ctx.lineTo(280, 540);
      ctx.lineTo(260, 480);
      ctx.lineTo(250, 420);
      ctx.lineTo(260, 360);
      ctx.lineTo(300, 310);
      ctx.lineTo(350, 280);
      ctx.lineTo(420, 250);
      ctx.lineTo(480, 230);
      ctx.lineTo(540, 220);
      ctx.lineTo(380, 200);
      ctx.lineTo(350, 170);
      ctx.lineTo(360, 140);
      ctx.lineTo(400, 120);
      ctx.lineTo(450, 130);
      ctx.lineTo(520, 150);
      ctx.lineTo(580, 120);
      ctx.lineTo(630, 90);
      ctx.lineTo(650, 80);
      ctx.closePath();
      
      ctx.fill();
      ctx.stroke();
      
      const cities = [
        { name: 'Praha', x: 620, y: 320, icon: 'ğŸ°' },
        { name: 'PaÅ™Ã­Å¾', x: 380, y: 300, icon: 'ğŸ—¼' },
        { name: 'Stockholm', x: 800, y: 180, icon: 'â„ï¸' },
        { name: 'Amsterdam', x: 480, y: 240, icon: 'ğŸŒ·' },
        { name: 'Madrid', x: 300, y: 530, icon: 'â˜€ï¸' },
        { name: 'Oslo', x: 750, y: 150, icon: 'â›·ï¸' },
        { name: 'Å˜Ã­m', x: 580, y: 600, icon: 'ğŸ›ï¸' },
        { name: 'LondÃ½n', x: 360, y: 220, icon: 'ğŸ©' },
        { name: 'BerlÃ­n', x: 550, y: 270, icon: 'ğŸ§±' },
        { name: 'VÃ­deÅˆ', x: 630, y: 360, icon: 'ğŸ»' },
        { name: 'Lisabon', x: 220, y: 520, icon: 'â›µ' },
        { name: 'Barcelona', x: 360, y: 560, icon: 'ğŸ–ï¸' },
        { name: 'AtÃ©ny', x: 750, y: 650, icon: 'ğŸº' },
        { name: 'BudapeÅ¡Å¥', x: 700, y: 390, icon: 'ğŸŒ‰' },
        { name: 'Å trasburk', x: 440, y: 310, icon: 'ğŸ‡ªğŸ‡º' }
      ];
      
      cities.forEach(city => {
        ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
        ctx.beginPath();
        ctx.arc(city.x, city.y, 20, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.strokeStyle = 'rgba(50, 50, 50, 0.8)';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(city.x, city.y, 20, 0, Math.PI * 2);
        ctx.stroke();
        
        ctx.font = '24px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(city.icon, city.x, city.y);
      });

      drawFragments();
      drawPlayer();

      ctx.restore();

      drawInteractionPrompt();
    }

    function drawFragments() {
      fragments.forEach(fragment => {
        if (fragment.collected) return;

        const colors = {
          elite: '#ffd700',
          denier: '#ff4444',
          scientist: '#0088ff',
          activist: '#88ff00'
        };

        const pulseScale = 1 + Math.sin(fragment.pulse) * 0.2;
        const size = 35 * pulseScale;

        ctx.fillStyle = colors[fragment.type];
        ctx.shadowBlur = 30;
        ctx.shadowColor = colors[fragment.type];

        ctx.beginPath();
        ctx.arc(fragment.x, fragment.y, size * 0.9, 0, Math.PI * 2);
        ctx.fill();

        ctx.shadowBlur = 0;

        ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
        ctx.font = `${size * 1.4}px Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('ğŸ“œ', fragment.x, fragment.y);

        const dist = Math.sqrt((fragment.x - player.x) ** 2 + (fragment.y - player.y) ** 2);
        if (dist < 180) {
          ctx.fillStyle = colors[fragment.type];
          ctx.font = `bold 16px "Courier New"`;
          ctx.fillText(fragment.location, fragment.x, fragment.y - 55);
          
          if (dist < 60) {
            ctx.fillStyle = '#00ff88';
            ctx.font = `bold 14px "Courier New"`;
            ctx.shadowBlur = 8;
            ctx.shadowColor = '#00ff88';
            ctx.fillText('[E] Sebrat fragment', fragment.x, fragment.y + 55);
            ctx.shadowBlur = 0;
          }
        }
      });
    }

    function drawPlayer() {
      ctx.fillStyle = '#00ff88';
      ctx.shadowBlur = 20;
      ctx.shadowColor = '#00ff88';
      
      ctx.beginPath();
      ctx.moveTo(player.x, player.y - player.size);
      ctx.lineTo(player.x - player.size * 0.7, player.y + player.size * 0.6);
      ctx.lineTo(player.x, player.y + player.size * 0.3);
      ctx.lineTo(player.x + player.size * 0.7, player.y + player.size * 0.6);
      ctx.closePath();
      ctx.fill();

      ctx.shadowBlur = 0;

      ctx.strokeStyle = 'rgba(0, 255, 136, 0.4)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(player.x, player.y, 50, 0, Math.PI * 2);
      ctx.stroke();
    }

    function drawInteractionPrompt() {
      const nearest = getNearestFragment();
      if (nearest && nearest.distance < 60 && !nearest.collected) {
        const text = `ğŸ“ ${nearest.location} - Stiskni [E]`;
        
        ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
        ctx.fillRect(canvas.width / 2 - 220, 100, 440, 60);
        
        ctx.strokeStyle = '#00ff88';
        ctx.lineWidth = 3;
        ctx.strokeRect(canvas.width / 2 - 220, 100, 440, 60);
        
        ctx.fillStyle = '#00ff88';
        ctx.font = 'bold 18px "Courier New"';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(text, canvas.width / 2, 130);
      }
    }

    function setupMobileControls() {
      const dirButtons = document.querySelectorAll('.mobile-btn[data-dir]');
      const actionBtn = document.getElementById('mobileAction');

      // D-pad â€“ pohyb â†•â†” (emulujeme stisk WASD/Å¡ipek pÅ™es objekt keys)
      dirButtons.forEach(btn => {
        const dir = btn.dataset.dir;

        const start = (e) => {
          e.preventDefault();
          setDirKey(dir, true);
        };

        const end = (e) => {
          e.preventDefault();
          setDirKey(dir, false);
        };

        // touch
        btn.addEventListener('touchstart', start);
        btn.addEventListener('touchend', end);
        btn.addEventListener('touchcancel', end);

        // pro pÅ™Ã­pad testovÃ¡nÃ­ na PC myÅ¡Ã­
        btn.addEventListener('mousedown', start);
        btn.addEventListener('mouseup', end);
        btn.addEventListener('mouseleave', end);
      });

      // TlaÄÃ­tko E â€“ sebrÃ¡nÃ­ fragmentu (stejnÃ¡ logika jako v handleKeyDown pro klÃ¡vesu E)
      if (actionBtn) {
        const triggerAction = (e) => {
          e.preventDefault();
          if (gameState === 'playing') {
            const nearestFragment = getNearestFragment();
            if (nearestFragment && nearestFragment.distance < 60 && !nearestFragment.collected) {
              showFragmentModal(nearestFragment);
            }
          }
        };

        actionBtn.addEventListener('click', triggerAction);
        actionBtn.addEventListener('touchstart', triggerAction);
      }
    }

    function setDirKey(dir, isDown) {
      if (!keys) return;
      if (dir === 'up') {
        keys['w'] = isDown;
        keys['arrowup'] = isDown;
      }
      if (dir === 'down') {
        keys['s'] = isDown;
        keys['arrowdown'] = isDown;
      }
      if (dir === 'left') {
        keys['a'] = isDown;
        keys['arrowleft'] = isDown;
      }
      if (dir === 'right') {
        keys['d'] = isDown;
        keys['arrowright'] = isDown;
      }
    }

    let lastTime = performance.now();
    function gameLoop() {
      const currentTime = performance.now();
      const dt = Math.min((currentTime - lastTime) / 1000, 0.1);
      lastTime = currentTime;

      update(dt);
      render();
      requestAnimationFrame(gameLoop);
    }

    function start() {
      init();
    }

    start();
  </script>
  <script>
    (function(){
      function c(){
        var b=a.contentDocument||a.contentWindow.document;
        if(b){
          var d=b.createElement('script');
          d.innerHTML="window.__CF$cv$params={r:'9a6a184107961033',t:'MTc2NDUwMzA4Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
          b.getElementsByTagName('head')[0].appendChild(d)
        }
      }
      if(document.body){
        var a=document.createElement('iframe');
        a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);
        if('loading'!==document.readyState)c();
        else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);
        else{
          var e=document.onreadystatechange||function(){};
          document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}
        }
      }
    })();
  </script>
 </body>
</html>
